<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N1HS7C9R8N"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-N1HS7C9R8N');</script>
    <title>Creator Portal — Officially Human Art</title>
    <meta name="description" content="Register your creative work and receive a certificate of human creation. Submit evidence of your process and prove your art is authentically human-made.">
    <link rel="canonical" href="https://officiallyhuman.art/register.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Creator Portal — Officially Human Art">
    <meta property="og:description" content="Register your creative work and receive a certificate of human creation. Prove your art is authentically human-made.">
    <meta property="og:url" content="https://officiallyhuman.art/register.html">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Creator Portal — Officially Human Art">
    <meta name="twitter:description" content="Register your creative work and receive a certificate of human creation. Prove your art is authentically human-made.">
    <link rel="stylesheet" href="/fonts/fonts.css">
    <link rel="icon" type="image/svg+xml" href="/fingerprint-favicon.svg">
    <style>
        :root {
            --navy: #2a2520;
            --navy-light: #3d3630;
            --navy-dark: #1a1510;
            --cream: #f5f0e8;
            --cream-dark: #ebe5da;
            --gold: #3d3427;
            --gold-light: #4a4035;
            --gold-pale: #f0e6d2;
            --ink: #1a1a1a;
            --ink-light: #555555;
            --ink-faint: #888888;
            --success: #276749;
            --error: #c53030;
            --bronze: #c4935a;
            --silver: #9ca3af;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--cream);
            color: var(--ink);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        header {
            padding: 1.25rem 0;
            position: sticky;
            top: 0;
            background: rgba(245, 240, 232, 0.92);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(26, 26, 26, 0.08);
            z-index: 100;
        }

        .header-inner {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Inter', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--navy);
            text-decoration: none;
            letter-spacing: -0.02em;
        }

        .logo span { color: var(--gold); }

        nav { display: flex; gap: 1.5rem; align-items: center; }

        nav a {
            color: var(--ink-light);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: color 0.2s;
        }

        nav a:hover { color: var(--navy); }

        /* Main container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 2rem;
            position: relative;
            z-index: 1;
        }

        /* Page header */
        .page-header {
            text-align: center;
            padding: 3rem 0 2rem;
        }

        .page-header h1 {
            font-family: 'Fraunces', serif;
            font-size: clamp(2rem, 4vw, 2.75rem);
            font-weight: 500;
            color: var(--navy);
            line-height: 1.15;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .page-header h1 em { font-style: italic; color: var(--gold); }

        .page-header p {
            color: var(--ink-light);
            font-size: 1.05rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid rgba(26, 26, 26, 0.08);
            margin-bottom: 2rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab-btn {
            padding: 0.875rem 1.5rem;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--ink-faint);
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tab-btn:hover { color: var(--navy); }

        .tab-btn.active {
            color: var(--navy);
            border-bottom-color: var(--gold);
        }

        .tab-btn.hidden { display: none; }

        .tab-panel { display: none; animation: fadeIn 0.3s ease; }
        .tab-panel.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: white;
            border: 1px solid rgba(26, 26, 26, 0.08);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(26, 26, 26, 0.04);
        }

        .card-title {
            font-family: 'Fraunces', serif;
            font-size: 1.5rem;
            color: var(--navy);
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            color: var(--ink-light);
            font-size: 0.9rem;
            margin-bottom: 2rem;
        }

        /* Form elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 0.4rem;
        }

        label .required {
            color: var(--error);
            margin-left: 0.15rem;
        }

        label .optional {
            color: var(--ink-faint);
            font-weight: 400;
            font-size: 0.8rem;
        }

        input[type="text"],
        input[type="email"],
        input[type="url"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            color: var(--ink);
            background: var(--cream);
            border: 1px solid rgba(26, 26, 26, 0.18);
            border-radius: 6px;
            transition: all 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--navy);
            box-shadow: 0 0 0 3px rgba(26, 26, 26, 0.08);
        }

        textarea { resize: vertical; min-height: 100px; }

        select {
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%234a5568' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 2.5rem;
        }

        .char-count {
            text-align: right;
            font-size: 0.75rem;
            color: var(--ink-faint);
            margin-top: 0.25rem;
        }

        .form-hint {
            font-size: 0.8rem;
            color: var(--ink-faint);
            margin-top: 0.3rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--navy);
            color: var(--cream);
            text-decoration: none;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover { background: var(--navy-light); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(26, 26, 26, 0.2); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-gold { background: var(--gold); }
        .btn-gold:hover { background: var(--gold-light); }
        .btn-outline { background: transparent; border: 1.5px solid var(--navy); color: var(--navy); }
        .btn-outline:hover { background: var(--navy); color: var(--cream); }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.8rem; }
        .btn-full { width: 100%; }
        .btn-lg { padding: 1rem 2rem; font-size: 1rem; }

        /* Evidence upload area */
        .upload-area {
            border: 2px dashed rgba(26, 26, 26, 0.2);
            border-radius: 10px;
            padding: 2.5rem 2rem;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
            background: rgba(26, 26, 26, 0.01);
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--navy);
            background: rgba(26, 26, 26, 0.03);
        }

        .upload-area.dragover {
            border-color: var(--gold);
            background: var(--gold-pale);
        }

        .upload-icon {
            width: 48px; height: 48px;
            margin: 0 auto 1rem;
            background: rgba(26, 26, 26, 0.06);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem;
            color: var(--navy);
        }

        .upload-area h4 {
            font-family: 'Fraunces', serif;
            font-size: 1.15rem;
            color: var(--navy);
            margin-bottom: 0.35rem;
        }

        .upload-area p {
            font-size: 0.85rem;
            color: var(--ink-faint);
        }

        .upload-area p strong {
            color: var(--navy);
            text-decoration: underline;
            cursor: pointer;
        }

        .file-input-hidden { display: none; }

        /* File thumbnails */
        .file-thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .file-thumb {
            position: relative;
            border-radius: 8px;
            border: 1px solid rgba(26, 26, 26, 0.1);
            background: var(--cream-dark);
        }

        .file-thumb .thumb-preview {
            aspect-ratio: 1;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            position: relative;
        }

        .file-thumb img {
            width: 100%; height: 100%;
            object-fit: cover;
            display: block;
        }

        .file-thumb .file-icon {
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            color: var(--ink-faint);
            padding: 0.5rem;
            word-break: break-all;
            text-align: center;
        }

        .file-thumb .file-icon-symbol {
            display: block;
            width: 28px; height: 28px;
            margin-bottom: 0.35rem;
            background: rgba(26, 26, 26, 0.1);
            border-radius: 4px;
        }

        .file-thumb-remove {
            position: absolute;
            top: 4px; right: 4px;
            width: 22px; height: 22px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            transition: background 0.2s;
        }

        .file-thumb-remove:hover { background: var(--error); }

        .file-count {
            font-size: 0.8rem;
            color: var(--ink-faint);
            margin-top: 0.5rem;
        }

        /* Evidence strength meter */
        .strength-meter {
            margin-top: 1.5rem;
            padding: 1.25rem 1.5rem;
            background: var(--cream-dark);
            border-radius: 8px;
            border: 1px solid rgba(26, 26, 26, 0.06);
        }

        .strength-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.6rem;
        }

        .strength-label-text {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--ink);
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .strength-tier {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: 0.2rem 0.75rem;
            border-radius: 100px;
        }

        .strength-tier.tier-bronze { background: #f5ebe0; color: #a0764a; }
        .strength-tier.tier-silver { background: #edf0f4; color: #6b7280; }
        .strength-tier.tier-gold { background: #faf3e0; color: #a08530; }

        .strength-bar-track {
            width: 100%;
            height: 8px;
            background: rgba(26, 26, 26, 0.08);
            border-radius: 100px;
            overflow: hidden;
        }

        .strength-bar-fill {
            height: 100%;
            border-radius: 100px;
            transition: width 0.4s ease, background 0.4s ease;
            width: 0%;
        }

        .strength-bar-fill.tier-bronze { background: var(--bronze); }
        .strength-bar-fill.tier-silver { background: var(--silver); }
        .strength-bar-fill.tier-gold { background: var(--gold); }

        .strength-details {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem 1rem;
            margin-top: 0.75rem;
        }

        .strength-item {
            font-size: 0.72rem;
            color: var(--ink-faint);
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .strength-check {
            width: 14px; height: 14px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.55rem;
            flex-shrink: 0;
        }

        .strength-check.done {
            background: rgba(39, 103, 73, 0.12);
            color: var(--success);
        }

        .strength-check.pending {
            background: rgba(26, 26, 26, 0.06);
            color: var(--ink-faint);
        }

        /* Declaration */
        .declaration {
            background: var(--cream-dark);
            border: 1px solid rgba(26, 26, 26, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .declaration h4 {
            font-family: 'Fraunces', serif;
            font-size: 1.1rem;
            color: var(--navy);
            margin-bottom: 0.75rem;
        }

        .declaration-text {
            font-size: 0.85rem;
            color: var(--ink-light);
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px; height: 18px;
            margin-top: 2px;
            accent-color: var(--navy);
            flex-shrink: 0;
        }

        .checkbox-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--ink);
            cursor: pointer;
            margin-bottom: 0;
        }

        /* Dashboard */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .dashboard-header h2 {
            font-family: 'Fraunces', serif;
            font-size: 1.75rem;
            color: var(--navy);
        }

        .dashboard-header h2 small {
            display: block;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 400;
            color: var(--ink-faint);
            margin-top: 0.15rem;
        }

        .profile-link {
            color: var(--navy);
            font-size: 0.85rem;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            transition: color 0.2s;
        }

        .profile-link:hover { color: var(--gold); }

        /* Certificate list */
        .cert-list { display: flex; flex-direction: column; gap: 1rem; }

        .cert-item {
            background: white;
            border: 1px solid rgba(26, 26, 26, 0.08);
            border-radius: 10px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            transition: box-shadow 0.2s;
        }

        .cert-item:hover { box-shadow: 0 4px 16px rgba(26, 26, 26, 0.08); }

        .cert-item-info { flex: 1; min-width: 200px; }

        .cert-item-title {
            font-family: 'Fraunces', serif;
            font-size: 1.2rem;
            color: var(--navy);
            margin-bottom: 0.25rem;
        }

        .cert-item-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem 1.25rem;
            font-size: 0.8rem;
            color: var(--ink-faint);
        }

        .cert-item-meta a {
            color: var(--navy);
            text-decoration: none;
            font-family: monospace;
            font-size: 0.78rem;
            letter-spacing: 0.04em;
        }

        .cert-item-meta a:hover { color: var(--gold); text-decoration: underline; }

        .cert-item-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .cert-action-btn {
            background: none;
            border: 1px solid rgba(26, 26, 26, 0.15);
            border-radius: 6px;
            padding: 0.35rem 0.65rem;
            font-size: 0.75rem;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--ink-faint);
            text-decoration: none;
        }
        .cert-action-btn:hover { border-color: var(--navy); color: var(--navy); }
        .cert-action-btn.delete-btn:hover { border-color: var(--error); color: var(--error); }

        /* Modal overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.show { display: flex; }

        .modal-box {
            background: white;
            border-radius: 14px;
            max-width: 520px;
            width: 90%;
            padding: 2rem;
            position: relative;
            box-shadow: 0 24px 72px rgba(26, 26, 26, 0.2);
            animation: slideUp 0.3s ease;
        }

        .modal-box h3 {
            font-family: 'Fraunces', serif;
            font-size: 1.35rem;
            color: var(--navy);
            margin-bottom: 0.75rem;
        }

        .modal-close {
            position: absolute;
            top: 1rem; right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--ink-faint);
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            justify-content: flex-end;
        }

        .tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.25rem 0.7rem;
            border-radius: 100px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .tier-badge.tier-gold { background: #faf3e0; color: #a08530; }
        .tier-badge.tier-silver { background: #edf0f4; color: #6b7280; }
        .tier-badge.tier-bronze { background: #f5ebe0; color: #a0764a; }

        /* Embed dropdown */
        .embed-wrap { position: relative; }

        .embed-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            width: 420px;
            max-width: calc(100vw - 4rem);
            background: white;
            border: 1px solid rgba(26, 26, 26, 0.12);
            border-radius: 10px;
            box-shadow: 0 12px 40px rgba(26, 26, 26, 0.15);
            z-index: 50;
            padding: 1.5rem;
        }

        .embed-dropdown.show { display: block; }

        .embed-dropdown h4 {
            font-family: 'Fraunces', serif;
            font-size: 1.1rem;
            color: var(--navy);
            margin-bottom: 1rem;
        }

        .embed-section { margin-bottom: 1rem; }
        .embed-section:last-child { margin-bottom: 0; }

        .embed-section-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--ink-faint);
            margin-bottom: 0.35rem;
            display: block;
        }

        .embed-code-box { position: relative; }

        .embed-code-box code {
            display: block;
            padding: 0.75rem;
            padding-right: 3.5rem;
            background: var(--cream-dark);
            border: 1px solid rgba(26, 26, 26, 0.08);
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.72rem;
            color: var(--ink-light);
            overflow-x: auto;
            white-space: pre;
            line-height: 1.5;
        }

        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.3rem 0.6rem;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--navy);
            color: var(--cream);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: background 0.2s;
        }

        .copy-btn:hover { background: var(--navy-light); }
        .copy-btn.copied { background: var(--success); }

        .embed-badge-preview {
            padding: 1rem;
            background: var(--cream-dark);
            border-radius: 6px;
            text-align: center;
            border: 1px solid rgba(26, 26, 26, 0.06);
        }

        .embed-badge-preview img {
            max-width: 200px;
            height: auto;
        }

        /* Success card */
        .success-card {
            display: none;
            background: white;
            border: 2px solid rgba(39, 103, 73, 0.2);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 2rem;
            animation: fadeIn 0.4s ease;
        }

        .success-card.show { display: block; }

        .success-card-header {
            background: linear-gradient(135deg, var(--success), #2f855a);
            color: white;
            padding: 1.5rem 2rem;
            text-align: center;
        }

        .success-card-header h3 {
            font-family: 'Fraunces', serif;
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .success-card-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .success-card-body { padding: 2rem; }

        .success-detail {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .success-detail-item { }

        .success-detail-label {
            display: block;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--ink-faint);
            margin-bottom: 0.2rem;
            font-weight: 600;
        }

        .success-detail-value {
            font-size: 0.95rem;
            color: var(--ink);
        }

        .success-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Alerts */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            display: none;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .alert.show { display: flex; }

        .alert-error {
            background: rgba(197, 48, 48, 0.08);
            border: 1px solid rgba(197, 48, 48, 0.15);
            color: var(--error);
        }

        .alert-success {
            background: rgba(39, 103, 73, 0.08);
            border: 1px solid rgba(39, 103, 73, 0.15);
            color: var(--success);
        }

        .alert-icon { font-size: 1.1rem; flex-shrink: 0; line-height: 1.4; }

        /* User bar */
        .user-bar {
            display: none;
            padding: 0.75rem 1.25rem;
            background: rgba(39, 103, 73, 0.06);
            border: 1px solid rgba(39, 103, 73, 0.12);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: var(--success);
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .user-bar.show { display: flex; }

        .user-bar strong { color: var(--ink); }

        .user-bar button {
            background: none;
            border: none;
            color: var(--ink-faint);
            font-size: 0.8rem;
            cursor: pointer;
            font-family: inherit;
            text-decoration: underline;
        }

        .user-bar button:hover { color: var(--error); }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--ink-faint);
        }

        .empty-state-icon {
            width: 64px; height: 64px;
            margin: 0 auto 1rem;
            background: rgba(26, 26, 26, 0.04);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .empty-state h3 {
            font-family: 'Fraunces', serif;
            font-size: 1.25rem;
            color: var(--ink-light);
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 16px; height: 16px;
            border: 2px solid rgba(245, 240, 232, 0.3);
            border-top-color: var(--cream);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        .spinner-dark {
            border-color: rgba(26, 26, 26, 0.15);
            border-top-color: var(--navy);
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Footer */
        footer {
            padding: 3rem 0;
            border-top: 1px solid rgba(26, 26, 26, 0.08);
            margin-top: 3rem;
        }

        .footer-inner {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .footer-links { display: flex; gap: 1.5rem; }
        .footer-links a { color: var(--ink-faint); text-decoration: none; font-size: 0.85rem; }
        .footer-links a:hover { color: var(--navy); }
        footer p { color: var(--ink-faint); font-size: 0.85rem; }

        /* Responsive */
        @media (max-width: 768px) {
            .card { padding: 1.5rem; }
            .form-row { grid-template-columns: 1fr; gap: 0; }
            .dashboard-header { flex-direction: column; align-items: flex-start; }
            .cert-item { flex-direction: column; align-items: flex-start; }
            .cert-item-actions { width: 100%; justify-content: flex-start; }
            .embed-dropdown { right: auto; left: 0; }
            .success-detail { grid-template-columns: 1fr; }
            .file-thumbnails { grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); }
            nav { gap: 1rem; }
        }

        @media (max-width: 480px) {
            .tabs { gap: 0; }
            .tab-btn { padding: 0.75rem 0.75rem; font-size: 0.8rem; }
            .page-header { padding: 2rem 0 1.5rem; }
            .footer-inner { flex-direction: column; text-align: center; }
        }

        /* Auth Area */
        .auth-area {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }

        .auth-area[data-state="loading"] .auth-login-btn,
        .auth-area[data-state="loading"] .auth-user-name,
        .auth-area[data-state="loading"] .auth-signout-btn { display: none; }

        .auth-area[data-state="signed-out"] .auth-user-name,
        .auth-area[data-state="signed-out"] .auth-signout-btn { display: none; }

        .auth-area[data-state="signed-in"] .auth-login-btn { display: none; }
        .auth-area[data-state="signed-in"] .auth-dropdown { display: none !important; }

        .auth-btn {
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .auth-login-btn {
            padding: 0.45rem 1rem;
            background: transparent;
            border: 1.5px solid var(--navy);
            color: var(--navy);
        }

        .auth-login-btn:hover {
            background: var(--navy);
            color: var(--cream);
        }

        .auth-user-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--navy);
        }

        .auth-signout-btn {
            padding: 0.4rem 0.85rem;
            background: transparent;
            color: var(--ink-faint);
            font-size: 0.8rem;
        }

        .auth-signout-btn:hover { color: var(--error); }

        .auth-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 0.75rem);
            right: 0;
            width: 320px;
            background: white;
            border-radius: 12px;
            border: 1px solid rgba(26, 26, 26, 0.1);
            box-shadow: 0 12px 40px rgba(26, 26, 26, 0.15);
            padding: 1.5rem;
            z-index: 200;
            animation: authSlideDown 0.2s ease;
        }

        .auth-dropdown.open { display: block; }

        @keyframes authSlideDown {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-dropdown h3 {
            font-family: 'Inter', sans-serif;
            font-size: 1.25rem;
            color: var(--navy);
            margin-bottom: 1rem;
        }

        .auth-error {
            display: none;
            padding: 0.6rem 0.85rem;
            background: rgba(197, 48, 48, 0.08);
            color: var(--error);
            border-radius: 6px;
            font-size: 0.82rem;
            margin-bottom: 0.75rem;
        }

        .auth-error.show { display: block; }

        .auth-field { margin-bottom: 0.85rem; }

        .auth-field label {
            display: block;
            font-size: 0.78rem;
            font-weight: 600;
            color: var(--ink-light);
            margin-bottom: 0.3rem;
        }

        .auth-field input {
            width: 100%;
            padding: 0.6rem 0.85rem;
            border: 1.5px solid rgba(26, 26, 26, 0.18);
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            color: var(--ink);
            background: var(--cream);
            transition: border-color 0.2s;
        }

        .auth-field input:focus {
            outline: none;
            border-color: var(--navy);
        }

        .auth-submit-btn {
            width: 100%;
            padding: 0.7rem;
            background: var(--navy);
            color: var(--cream);
            border: none;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .auth-submit-btn:hover { background: var(--navy-light); }
        .auth-submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }

        .auth-footer {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.82rem;
            color: var(--ink-faint);
        }

        .auth-footer a {
            color: var(--navy);
            font-weight: 600;
            text-decoration: none;
        }

        .auth-footer a:hover { text-decoration: underline; }

        @media (max-width: 480px) {
            .auth-dropdown {
                width: calc(100vw - 2rem);
                right: -1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <a href="/" class="logo" style="display:flex;align-items:center;gap:12px;text-decoration:none;font-family:'Inter',sans-serif;">
    <svg viewBox="0 0 70 85" fill="none" stroke="currentColor" stroke-width="1.2" xmlns="http://www.w3.org/2000/svg" style="width:36px;height:44px;color:#1a1a1a;">
        <path d="M35 5 C15 5 5 22 5 42 C5 62 15 80 35 80" stroke-linecap="round"/>
        <path d="M35 12 C20 12 12 26 12 42 C12 58 20 72 35 72 C50 72 58 58 58 42" stroke-linecap="round"/>
        <path d="M35 19 C24 19 18 30 18 42 C18 54 24 65 35 65 C46 65 52 54 52 42 C52 30 46 19 35 19" stroke-linecap="round"/>
        <path d="M35 26 C28 26 24 33 24 42 C24 51 28 58 35 58 C42 58 46 51 46 42" stroke-linecap="round"/>
        <path d="M35 33 C31 33 29 37 29 42 C29 47 31 51 35 51 C39 51 41 47 41 42 C41 37 39 33 35 33" stroke-linecap="round"/>
        <path d="M65 42 C65 22 55 5 35 5" stroke-linecap="round"/>
        <path d="M58 42 C58 26 50 12 35 12" stroke-linecap="round"/>
    </svg>
    <span style="display:flex;flex-direction:column;line-height:1.1;">
        <span style="font-size:14px;"><span style="font-weight:300;color:#666666;">officially</span><span style="font-weight:600;color:#1a1a1a;">human</span></span>
        <span style="font-size:24px;font-weight:700;color:#1a1a1a;margin-top:-2px;">.art</span>
    </span>
</a>
            <nav>
                <a href="verify.html">Verify</a>
                <a href="/">Home</a>
                <div class="auth-area" id="auth-area" data-state="loading">
                    <button type="button" class="auth-btn auth-login-btn" id="auth-login-toggle">Log In</button>
                    <span class="auth-user-name" id="auth-user-name"></span>
                    <button type="button" class="auth-btn auth-signout-btn" id="auth-signout-btn">Sign Out</button>
                    <div class="auth-dropdown" id="auth-dropdown">
                        <h3>Sign In</h3>
                        <div class="auth-error" id="auth-error"></div>
                        <form id="auth-login-form">
                            <div class="auth-field">
                                <label for="auth-email">Email</label>
                                <input type="email" id="auth-email" required autocomplete="email">
                            </div>
                            <div class="auth-field">
                                <label for="auth-password">Password</label>
                                <input type="password" id="auth-password" required autocomplete="current-password">
                            </div>
                            <button type="submit" class="auth-submit-btn" id="auth-submit-btn">Sign In</button>
                        </form>
                        <div class="auth-footer">
                            Don't have an account? <a href="register.html">Create one</a>
                            <br><a href="#" id="auth-forgot-link" style="color:var(--ink-faint);">Forgot password?</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="page-header">
            <h1>Creator <em>Portal</em></h1>
            <p>Register your work. Prove it's officially human.</p>
        </div>

        <!-- Email verification banner -->
        <div id="verify-email-banner" style="display:none;background:#fef3c7;border:1px solid #f59e0b;border-radius:8px;padding:1rem 1.25rem;margin-bottom:1rem;font-size:0.9rem;color:#92400e;">
            <strong>Please verify your email.</strong> Check your inbox for a verification link. You won't be able to submit artwork until your email is verified.
            <button type="button" id="resend-verification-btn" style="margin-left:0.75rem;background:#1a1a1a;color:#f5f0e8;border:none;padding:0.35rem 0.85rem;border-radius:5px;font-size:0.82rem;font-weight:600;cursor:pointer;">Resend Email</button>
            <span id="resend-status" style="margin-left:0.5rem;font-size:0.82rem;"></span>
        </div>

        <!-- User bar -->
        <div class="user-bar" id="user-bar">
            <span>Signed in as <strong id="user-name"></strong> <span style="color:#888888;font-size:0.85em;" id="user-email"></span> <span id="plan-badge"></span></span>
            <button type="button" id="signout-btn">Sign out</button>
        </div>

        <!-- Tabs -->
        <div class="tabs" id="tabs-bar">
            <button class="tab-btn active" data-tab="signin" id="tab-signin">Sign In</button>
            <button class="tab-btn" data-tab="register" id="tab-register">Create Account</button>
            <button class="tab-btn hidden" data-tab="submit" id="tab-submit">Submit Artwork</button>
            <button class="tab-btn hidden" data-tab="dashboard" id="tab-dashboard">My Certificates</button>
        </div>

        <!-- SIGN IN TAB -->
        <div class="tab-panel active" id="panel-signin">
            <div class="card">
                <h2 class="card-title">Welcome Back</h2>
                <p class="card-subtitle">Sign in to access your artist portal.</p>
                <div id="signin-alert" class="alert alert-error">
                    <span class="alert-icon">!</span>
                    <span id="signin-alert-msg"></span>
                </div>
                <form id="signin-form">
                    <div class="form-group">
                        <label for="signin-email">Email Address <span class="required">*</span></label>
                        <input type="email" id="signin-email" name="email" placeholder="you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="signin-password">Password <span class="required">*</span></label>
                        <input type="password" id="signin-password" name="password" placeholder="Your password" required>
                    </div>
                    <button type="submit" class="btn btn-lg btn-full" id="signin-btn">Sign In</button>
                    <div style="text-align:center;margin-top:1rem;">
                        <a href="#" id="forgot-password-link" style="font-size:0.85rem;color:var(--ink-faint);text-decoration:none;">Forgot your password?</a>
                    </div>
                </form>

                <!-- Forgot Password Form (hidden by default) -->
                <div id="forgot-form-wrap" style="display:none;">
                    <h2 class="card-title">Reset Password</h2>
                    <p class="card-subtitle">Enter your email and we'll send you a reset link.</p>
                    <div id="forgot-alert" class="alert" style="display:none;">
                        <span class="alert-icon">!</span>
                        <span id="forgot-alert-msg"></span>
                    </div>
                    <div class="form-group">
                        <label for="forgot-email">Email Address <span class="required">*</span></label>
                        <input type="email" id="forgot-email" placeholder="you@example.com" required>
                    </div>
                    <button type="button" class="btn btn-lg btn-full" id="forgot-submit-btn">Send Reset Link</button>
                    <div style="text-align:center;margin-top:1rem;">
                        <a href="#" id="back-to-signin-link" style="font-size:0.85rem;color:var(--ink-faint);text-decoration:none;">Back to Sign In</a>
                    </div>
                </div>

                <!-- Reset Password Form (shown via #reset=TOKEN) -->
                <div id="reset-form-wrap" style="display:none;">
                    <h2 class="card-title">Set New Password</h2>
                    <p class="card-subtitle">Choose a new password for your account.</p>
                    <div id="reset-alert" class="alert" style="display:none;">
                        <span class="alert-icon">!</span>
                        <span id="reset-alert-msg"></span>
                    </div>
                    <div class="form-group">
                        <label for="reset-password">New Password <span class="required">*</span></label>
                        <input type="password" id="reset-password" placeholder="Minimum 6 characters" minlength="6" required>
                    </div>
                    <div class="form-group">
                        <label for="reset-password-confirm">Confirm Password <span class="required">*</span></label>
                        <input type="password" id="reset-password-confirm" placeholder="Re-enter password" minlength="6" required>
                    </div>
                    <button type="button" class="btn btn-lg btn-full" id="reset-submit-btn">Update Password</button>
                </div>
            </div>
        </div>

        <!-- CREATE ACCOUNT TAB -->
        <div class="tab-panel" id="panel-register">
            <div class="card">
                <h2 class="card-title">Create Your Account</h2>
                <p class="card-subtitle">Set up your profile to start certifying your work.</p>
                <div id="register-alert" class="alert alert-error">
                    <span class="alert-icon">!</span>
                    <span id="register-alert-msg"></span>
                </div>
                <form id="register-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reg-name">Full Name <span class="required">*</span></label>
                            <input type="text" id="reg-name" name="name" placeholder="Elena Marchetti" required>
                        </div>
                        <div class="form-group">
                            <label for="reg-email">Email Address <span class="required">*</span></label>
                            <input type="email" id="reg-email" name="email" placeholder="you@example.com" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Password <span class="required">*</span></label>
                        <input type="password" id="reg-password" name="password" placeholder="At least 6 characters" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="reg-bio">Bio <span class="optional">(optional)</span></label>
                        <textarea id="reg-bio" name="bio" rows="3" placeholder="Tell us about your creative practice..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reg-location">Location <span class="optional">(optional)</span></label>
                            <input type="text" id="reg-location" name="location" placeholder="Florence, Italy">
                        </div>
                        <div class="form-group">
                            <label for="reg-portfolio">Portfolio URL <span class="optional">(optional)</span></label>
                            <input type="text" id="reg-portfolio" name="portfolioUrl" placeholder="yourportfolio.com">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-gold btn-lg btn-full" id="register-btn">Create Account</button>
                </form>
            </div>
        </div>

        <!-- SUBMIT ARTWORK TAB -->
        <div class="tab-panel" id="panel-submit">
            <div id="work-counter" style="display:none;text-align:center;font-size:0.85rem;color:var(--ink-faint);margin-bottom:1rem;"></div>

            <!-- Limit blocker (shown when Free tier at 3 works) -->
            <div id="limit-blocker" style="display:none;">
                <div class="card" style="text-align:center;padding:3rem 2rem;">
                    <div style="font-size:2.5rem;margin-bottom:1rem;opacity:0.4;">&#9670;</div>
                    <h2 class="card-title">Work Limit Reached</h2>
                    <p class="card-subtitle">Your Free plan allows up to 3 certified works. Buy a single credit or upgrade for unlimited.</p>
                    <div style="display:flex;gap:0.75rem;justify-content:center;margin-top:1.25rem;flex-wrap:wrap;">
                        <button type="button" class="btn btn-outline" id="buy-credit-btn">Buy 1 Credit &mdash; &pound;2</button>
                        <button type="button" class="btn btn-gold" id="upgrade-from-blocker">Upgrade to Creator &mdash; &pound;5/month</button>
                    </div>
                </div>
            </div>

            <div class="card" id="submit-card">
                <h2 class="card-title">Submit Your Work</h2>
                <p class="card-subtitle">Provide details and evidence to certify your work as authentically human-made.</p>
                <div id="submit-alert" class="alert alert-error">
                    <span class="alert-icon">!</span>
                    <span id="submit-alert-msg"></span>
                </div>
                <form id="submit-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="art-title">Title <span class="required">*</span></label>
                            <input type="text" id="art-title" name="title" placeholder="e.g. Twilight Over Florence" required>
                        </div>
                        <div class="form-group">
                            <label for="art-medium">Medium / Category <span class="required">*</span></label>
                            <select id="art-medium" name="medium" required>
                                <option value="">Select medium...</option>
                                <optgroup label="Visual Art">
                                    <option value="Oil Painting">Oil Painting</option>
                                    <option value="Acrylic Painting">Acrylic Painting</option>
                                    <option value="Watercolor">Watercolor</option>
                                    <option value="Drawing">Drawing</option>
                                    <option value="Digital Art (hand-drawn)">Digital Art (hand-drawn)</option>
                                    <option value="Photography">Photography</option>
                                    <option value="Sculpture">Sculpture</option>
                                    <option value="Mixed Media">Mixed Media</option>
                                    <option value="Printmaking">Printmaking</option>
                                    <option value="Textile/Fiber Art">Textile/Fiber Art</option>
                                    <option value="Ceramics">Ceramics</option>
                                    <option value="Illustration">Illustration</option>
                                </optgroup>
                                <optgroup label="Writing">
                                    <option value="Novel/Fiction">Novel / Fiction</option>
                                    <option value="Non-Fiction">Non-Fiction</option>
                                    <option value="Screenplay/Script">Screenplay / Script</option>
                                    <option value="Poetry">Poetry</option>
                                    <option value="Journalism/Article">Journalism / Article</option>
                                    <option value="Short Story">Short Story</option>
                                    <option value="Essay">Essay</option>
                                </optgroup>
                                <optgroup label="Music & Audio">
                                    <option value="Music Composition">Music Composition</option>
                                    <option value="Song/Lyrics">Song / Lyrics</option>
                                    <option value="Sound Design">Sound Design</option>
                                </optgroup>
                                <optgroup label="Other Creative Works">
                                    <option value="Film/Video">Film / Video</option>
                                    <option value="Animation">Animation</option>
                                    <option value="Game Design">Game Design</option>
                                    <option value="Graphic Design">Graphic Design</option>
                                    <option value="Fashion Design">Fashion Design</option>
                                    <option value="Architecture">Architecture</option>
                                    <option value="Other">Other</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="art-date">Date Registered <span class="required">*</span></label>
                        <input type="date" id="art-date" name="creationDate" required>
                    </div>
                    <div class="form-group">
                        <label for="art-description">Description <span class="required">*</span></label>
                        <textarea id="art-description" name="description" rows="4" placeholder="Describe your work, its inspiration, and what makes it uniquely human..." required></textarea>
                        <div class="char-count"><span id="desc-count">0</span> characters</div>
                    </div>
                    <div class="form-group">
                        <label for="art-process">Process Notes <span class="optional">(optional)</span></label>
                        <textarea id="art-process" name="processNotes" rows="3" placeholder="Describe your creative process, tools used, time taken..."></textarea>
                        <p class="form-hint">Including process notes strengthens your certification tier.</p>
                    </div>

                    <!-- Artwork image upload -->
                    <div class="form-group">
                        <label>Artwork Image <span class="optional">(recommended)</span></label>
                        <div class="upload-area" id="artwork-upload-area">
                            <div class="upload-icon">&#8686;</div>
                            <h4>Upload the finished piece</h4>
                            <p>or <strong id="artwork-browse-trigger">click to browse</strong></p>
                            <p style="margin-top:0.5rem;font-size:0.78rem;">This image will be displayed on your certificate page</p>
                        </div>
                        <input type="file" id="artwork-input" class="file-input-hidden" accept="image/*,video/mp4,video/webm,video/quicktime">
                        <div class="file-thumbnails" id="artwork-thumbnail"></div>
                    </div>

                    <!-- Process evidence / WIP upload -->
                    <div class="form-group">
                        <label>Process Evidence / WIPs <span class="optional">(optional, up to 10 files)</span></label>
                        <div class="upload-area" id="upload-area">
                            <div class="upload-icon">&#8686;</div>
                            <h4>Upload work-in-progress evidence</h4>
                            <p>or <strong id="browse-trigger">click to browse</strong></p>
                            <p style="margin-top:0.5rem;font-size:0.78rem;">WIP images, drafts, sketches, source files, screenshots</p>
                        </div>
                        <input type="file" id="evidence-input" class="file-input-hidden" multiple accept="image/*,video/*,.pdf,.psd,.ai,.svg,.sketch,.doc,.docx,.txt">
                        <div id="evidence-visibility-note" style="display:none;margin-top:0.75rem;padding:0.75rem 1rem;background:rgba(26,26,26,0.03);border:1px solid rgba(26,26,26,0.08);border-radius:8px;font-size:0.82rem;color:#666666;line-height:1.6;">
                            <strong style="color:#1a1a1a;">Visibility:</strong> Each file has a <em>"Show on certificate"</em> toggle. Files you mark as visible will be <strong>publicly shown</strong> on your verification page for anyone to see. Unmarked files stay private &mdash; they still count towards your evidence tier but won&rsquo;t be displayed publicly.
                        </div>
                        <div class="file-thumbnails" id="file-thumbnails"></div>
                        <div class="file-count" id="file-count"></div>
                    </div>

                    <!-- Writing-specific guidance -->
                    <div id="writing-guidance" style="display:none;margin-top:-0.5rem;margin-bottom:1rem;padding:1rem 1.25rem;background:rgba(26,26,26,0.03);border-radius:8px;border:1px solid rgba(26,26,26,0.08);">
                        <strong style="color:#1a1a1a;font-size:0.85rem;">Evidence suggestions for written works:</strong>
                        <ul style="margin-top:0.5rem;padding-left:1.25rem;font-size:0.82rem;color:#888888;line-height:1.8;">
                            <li>Early drafts or manuscript versions showing revisions</li>
                            <li>Handwritten notes, outlines, or brainstorming pages</li>
                            <li>Screenshots of your word processor with timestamps visible</li>
                            <li>Revision history exports (e.g. Google Docs version history)</li>
                            <li>Research notes or reference materials you gathered</li>
                            <li>Editor feedback or tracked-changes documents</li>
                        </ul>
                    </div>

                    <!-- Evidence Strength Meter -->
                    <div class="strength-meter" id="strength-meter">
                        <div class="strength-label">
                            <span class="strength-label-text">Evidence Strength</span>
                            <span class="strength-tier tier-bronze" id="strength-tier">Bronze</span>
                        </div>
                        <div class="strength-bar-track">
                            <div class="strength-bar-fill tier-bronze" id="strength-fill"></div>
                        </div>
                        <div class="strength-details" id="strength-details"></div>
                    </div>

                    <!-- Declaration -->
                    <div class="declaration" style="margin-top:1.5rem;">
                        <h4>Declaration of Human Creation</h4>
                        <div class="declaration-text">
                            I hereby declare that the work submitted above was created entirely by me as a human creator,
                            without the use of generative artificial intelligence tools for the creation of the primary creative
                            content. I understand that this declaration is made in good faith, and that providing false information
                            may result in the revocation of any certificate issued and the removal of my work from the Officially Human Art registry.
                            I grant Officially Human Art permission to display my certificate publicly for verification purposes.
                        </div>
                        <p style="font-size:0.82rem;border-top:1px solid rgba(26,26,26,0.08);padding-top:0.75rem;margin-top:0.75rem;color:#666666;">
                            <strong>Copyright Notice:</strong> All rights reserved by the original creator.
                            Registration with Officially Human Art does not transfer, assign, or affect copyright
                            ownership in any way. Your work remains yours.
                        </p>
                        <div class="checkbox-group">
                            <input type="checkbox" id="declaration-check" required>
                            <label for="declaration-check">I confirm that this work is authentically human-made and I agree to the declaration above.</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-gold btn-lg btn-full" id="submit-btn" disabled>Submit for Certification</button>
                </form>
            </div>
        </div>

        <!-- MY CERTIFICATES TAB -->
        <div class="tab-panel" id="panel-dashboard">
            <!-- Upgrade prompt (Free tier) -->
            <div id="upgrade-section" style="display:none;">
                <div class="card" style="text-align:center;padding:2rem;margin-bottom:1.5rem;border-color:var(--gold);background:linear-gradient(135deg, rgba(235,229,218,0.3), rgba(245,240,232,1));">
                    <h3 class="card-title" style="color:var(--gold);font-size:1.25rem;">Upgrade to Creator</h3>
                    <p style="color:var(--ink-light);font-size:0.9rem;margin-bottom:1.25rem;">Unlimited works, priority support, early access to new features &mdash; &pound;5/month</p>
                    <button type="button" class="btn btn-gold" id="upgrade-btn">Upgrade Now</button>
                    <p style="color:var(--ink-faint);font-size:0.75rem;margin-top:0.75rem;">Cancel anytime. All existing certificates remain active if you cancel.</p>
                </div>
            </div>

            <!-- Plan management (Creator tier) -->
            <div id="manage-plan-section" style="display:none;">
                <div class="card" style="padding:1.5rem;margin-bottom:1.5rem;">
                    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;">
                        <div>
                            <span style="display:inline-flex;align-items:center;gap:0.35rem;padding:0.25rem 0.75rem;background:var(--gold-pale);color:var(--gold);border-radius:100px;font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;">Creator Plan</span>
                            <p id="plan-status-text" style="font-size:0.85rem;color:var(--ink-light);margin-top:0.5rem;">Your Creator plan is active.</p>
                        </div>
                        <button type="button" class="btn btn-sm" id="cancel-plan-btn" style="color:var(--error);border:1px solid var(--error);background:transparent;">Cancel Plan</button>
                    </div>
                </div>
            </div>

            <!-- Success card -->
            <div class="success-card" id="success-card">
                <div class="success-card-header">
                    <h3>Artwork Certified Successfully</h3>
                    <p>Your certificate has been issued.</p>
                </div>
                <div class="success-card-body">
                    <div class="success-detail" id="success-details"></div>
                    <div class="success-actions" id="success-actions"></div>
                </div>
            </div>

            <div class="dashboard-header" id="dashboard-header">
                <h2 id="dashboard-title">My Certificates <small>Loading...</small></h2>
                <a href="#" class="profile-link" id="profile-link">View Public Profile &#8594;</a>
            </div>
            <div class="cert-list" id="cert-list"></div>
            <div class="empty-state" id="empty-state" style="display:none;">
                <div class="empty-state-icon">&#9671;</div>
                <h3>No certificates yet</h3>
                <p>Submit your first artwork to receive a certificate of human creation.</p>
                <button type="button" class="btn btn-gold" id="empty-submit-btn">Submit Artwork</button>
            </div>

            <div id="account-danger-zone" style="display:none;margin-top:3rem;padding-top:1.5rem;border-top:1px solid rgba(26,26,26,0.08);">
                <button type="button" id="delete-account-btn" style="background:none;border:none;color:var(--ink-faint);font-size:0.8rem;cursor:pointer;font-family:inherit;text-decoration:underline;">Delete account</button>
            </div>
        </div>
    </main>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="delete-modal">
        <div class="modal-box">
            <button type="button" class="modal-close" id="delete-modal-close">&times;</button>
            <h3>Withdraw Certificate</h3>
            <p style="color:var(--ink-light);font-size:0.9rem;line-height:1.6;">
                Are you sure you want to withdraw <strong id="delete-cert-title"></strong>? This will permanently remove the certificate from the registry. This action cannot be undone.
            </p>
            <div class="modal-actions">
                <button type="button" class="btn btn-sm btn-outline" id="delete-cancel-btn">Cancel</button>
                <button type="button" class="btn btn-sm" id="delete-confirm-btn" style="background:var(--error);">Withdraw</button>
            </div>
        </div>
    </div>

    <!-- Edit Certificate Modal -->
    <div class="modal-overlay" id="edit-modal">
        <div class="modal-box">
            <button type="button" class="modal-close" id="edit-modal-close">&times;</button>
            <h3>Edit Certificate</h3>
            <div id="edit-alert" class="alert alert-error" style="display:none;">
                <span class="alert-icon">!</span>
                <span id="edit-alert-msg"></span>
            </div>
            <div class="form-group" style="margin-top:1rem;">
                <label for="edit-title">Title</label>
                <input type="text" id="edit-title" class="form-input" required>
            </div>
            <div class="form-group">
                <label for="edit-description">Description</label>
                <textarea id="edit-description" class="form-input" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="edit-process-notes">Process Notes</label>
                <textarea id="edit-process-notes" class="form-input" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-sm btn-outline" id="edit-cancel-btn">Cancel</button>
                <button type="button" class="btn btn-sm btn-gold" id="edit-save-btn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal-overlay" id="delete-account-modal">
        <div class="modal-box">
            <button type="button" class="modal-close" id="delete-account-modal-close">&times;</button>
            <h3 style="color:var(--error);">Delete Account</h3>
            <p style="color:var(--ink-light);font-size:0.9rem;line-height:1.6;">
                This will <strong>permanently delete</strong> your account, all certificates, uploaded files, and associated data. This action cannot be undone.
            </p>
            <div id="delete-account-alert" class="alert alert-error" style="display:none;">
                <span class="alert-icon">!</span>
                <span id="delete-account-alert-msg"></span>
            </div>
            <div class="form-group" style="margin-top:1rem;">
                <label for="delete-account-password">Enter your password to confirm</label>
                <input type="password" id="delete-account-password" class="form-input" placeholder="Your password" required>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-sm btn-outline" id="delete-account-cancel-btn">Cancel</button>
                <button type="button" class="btn btn-sm" id="delete-account-confirm-btn" style="background:var(--error);">Delete My Account</button>
            </div>
        </div>
    </div>

    <!-- Stripe Payment Modal -->
    <div id="payment-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:200;align-items:center;justify-content:center;">
        <div style="background:white;border-radius:14px;max-width:480px;width:90%;padding:2.5rem;position:relative;box-shadow:0 24px 72px rgba(26,26,26,0.2);">
            <button type="button" id="payment-modal-close" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;color:var(--ink-faint);cursor:pointer;">&times;</button>
            <h2 class="card-title" style="margin-bottom:0.25rem;">Upgrade to Creator</h2>
            <p class="card-subtitle" style="margin-bottom:1.5rem;">&pound;5/month &mdash; unlimited certificates, QR codes, embed codes</p>

            <div id="payment-alert" class="alert alert-error" style="display:none;">
                <span class="alert-icon">!</span>
                <span id="payment-alert-msg"></span>
            </div>

            <div id="stripe-card-element" style="padding:0.875rem 1rem;border:1.5px solid rgba(26,26,26,0.18);border-radius:6px;background:var(--cream);margin-bottom:1.5rem;"></div>

            <button type="button" class="btn btn-gold btn-lg btn-full" id="payment-submit-btn">
                Subscribe &mdash; &pound;5/month
            </button>

            <p style="text-align:center;font-size:0.75rem;color:var(--ink-faint);margin-top:1rem;">
                Secure payment via Stripe. Cancel anytime from your dashboard.<br>
                If you cancel, all existing certificates remain fully active.
            </p>
        </div>
    </div>

    <footer>
        <div class="footer-inner">
            <a href="/" class="logo" style="display:flex;align-items:center;gap:10px;text-decoration:none;font-family:'Inter',sans-serif;">
    <svg viewBox="0 0 70 85" fill="none" stroke="currentColor" stroke-width="1.2" xmlns="http://www.w3.org/2000/svg" style="width:28px;height:34px;color:#1a1a1a;">
        <path d="M35 5 C15 5 5 22 5 42 C5 62 15 80 35 80" stroke-linecap="round"/>
        <path d="M35 12 C20 12 12 26 12 42 C12 58 20 72 35 72 C50 72 58 58 58 42" stroke-linecap="round"/>
        <path d="M35 19 C24 19 18 30 18 42 C18 54 24 65 35 65 C46 65 52 54 52 42 C52 30 46 19 35 19" stroke-linecap="round"/>
        <path d="M35 26 C28 26 24 33 24 42 C24 51 28 58 35 58 C42 58 46 51 46 42" stroke-linecap="round"/>
        <path d="M35 33 C31 33 29 37 29 42 C29 47 31 51 35 51 C39 51 41 47 41 42 C41 37 39 33 35 33" stroke-linecap="round"/>
        <path d="M65 42 C65 22 55 5 35 5" stroke-linecap="round"/>
        <path d="M58 42 C58 26 50 12 35 12" stroke-linecap="round"/>
    </svg>
    <span style="display:flex;flex-direction:column;line-height:1.1;">
        <span style="font-size:11px;"><span style="font-weight:300;color:#666666;">officially</span><span style="font-weight:600;color:#1a1a1a;">human</span></span>
        <span style="font-size:18px;font-weight:700;color:#1a1a1a;margin-top:-2px;">.art</span>
    </span>
</a>
            <div class="footer-links">
                <a href="/">Home</a>
                <a href="verify.html">Verify</a>
                <a href="contact.html">Contact</a>
                <a href="legal.html">Legal</a>
            </div>
            <p>&copy; 2026 Officially Human Art</p>
        </div>
    </footer>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
    (function() {
        'use strict';

        // ---- State ----
        var currentArtist = null;
        var artworkFile = null;
        var selectedFiles = [];
        var evidenceVisibility = [];
        var currentPlan = null;
        var stripeInstance = null;
        var csrfToken = null;
        var stripeElements = null;

        // ---- DOM Helpers ----
        function $(id) { return document.getElementById(id); }
        function escHtml(s) {
            var d = document.createElement('div');
            d.textContent = s || '';
            return d.innerHTML;
        }

        function csrfHeaders(contentType) {
            var h = {};
            if (contentType) h['Content-Type'] = contentType;
            if (csrfToken) h['X-CSRF-Token'] = csrfToken;
            return h;
        }

        // ---- Tab System ----
        var tabBtns = document.querySelectorAll('.tab-btn');
        var tabPanels = document.querySelectorAll('.tab-panel');

        function switchTab(name) {
            tabBtns.forEach(function(t) { t.classList.toggle('active', t.dataset.tab === name); });
            tabPanels.forEach(function(p) { p.classList.toggle('active', p.id === 'panel-' + name); });
            if (name === 'dashboard' && currentArtist) {
                loadCertificates();
            }
        }

        tabBtns.forEach(function(btn) {
            btn.addEventListener('click', function() { switchTab(btn.dataset.tab); });
        });

        $('empty-submit-btn').addEventListener('click', function() { switchTab('submit'); });

        // ---- Auth ----
        function setLoggedIn(artist) {
            currentArtist = artist;
            $('user-bar').classList.add('show');
            $('user-name').textContent = artist.name;
            $('user-email').textContent = '(' + artist.email + ')';
            $('tab-submit').classList.remove('hidden');
            $('tab-dashboard').classList.remove('hidden');
            $('tab-signin').classList.add('hidden');
            $('tab-register').classList.add('hidden');
            var slug = artist.slug || artist.id;
            $('profile-link').href = '/profile.html?artist=' + encodeURIComponent(slug);
            loadPlanInfo(artist.id);
            var dangerZone = $('account-danger-zone');
            if (dangerZone) dangerZone.style.display = '';
            // Show email verification banner if not verified
            var banner = $('verify-email-banner');
            if (banner) {
                banner.style.display = artist.emailVerified ? 'none' : 'block';
            }
            // Sync header auth area
            var ha = $('auth-area');
            if (ha) {
                ha.setAttribute('data-state', 'signed-in');
                var un = $('auth-user-name');
                if (un) un.textContent = artist.name;
            }
            // If #dashboard hash, go straight to certificates; otherwise default to submit
            if (window.location.hash === '#dashboard') {
                switchTab('dashboard');
            } else {
                switchTab('submit');
            }
        }

        function signOut() {
            fetch('/api/artist/logout', {
                method: 'POST',
                credentials: 'same-origin',
                headers: csrfHeaders()
            }).catch(function() {});
            currentArtist = null;
            selectedFiles = [];
            $('user-bar').classList.remove('show');
            $('tab-submit').classList.add('hidden');
            $('tab-dashboard').classList.add('hidden');
            $('tab-signin').classList.remove('hidden');
            $('tab-register').classList.remove('hidden');
            switchTab('signin');
            $('submit-form').reset();
            $('signin-form').reset();
            $('file-thumbnails').innerHTML = '';
            $('file-count').textContent = '';
            $('desc-count').textContent = '0';
            $('success-card').classList.remove('show');
            var dangerZone = $('account-danger-zone');
            if (dangerZone) dangerZone.style.display = 'none';
            // Sync header auth area
            var ha = $('auth-area');
            if (ha) {
                ha.setAttribute('data-state', 'signed-out');
                var un = $('auth-user-name');
                if (un) un.textContent = '';
            }
            updateStrength();
        }

        $('signout-btn').addEventListener('click', signOut);

        // Expose for header auth IIFE
        window._pageSetLoggedIn = setLoggedIn;
        window._pageSignOut = signOut;

        // Resend verification email
        $('resend-verification-btn').addEventListener('click', function() {
            var btn = $('resend-verification-btn');
            var status = $('resend-status');
            btn.disabled = true;
            status.textContent = 'Sending...';
            fetch('/api/artist/resend-verification', {
                method: 'POST',
                credentials: 'same-origin',
                headers: csrfHeaders('application/json')
            })
            .then(function(r) { return r.json(); })
            .then(function(d) {
                status.textContent = d.success ? 'Sent! Check your inbox.' : (d.message || 'Failed to send.');
            })
            .catch(function() { status.textContent = 'Error. Please try again.'; })
            .finally(function() { btn.disabled = false; });
        });

        // Check for email-verified hash
        if (window.location.hash === '#email-verified' && currentArtist) {
            var banner = $('verify-email-banner');
            if (banner) banner.style.display = 'none';
            // Refresh artist data
            fetch('/api/artist/me', { credentials: 'same-origin' })
                .then(function(r) { return r.json(); })
                .then(function(d) { if (d.success && d.artist) setLoggedIn(d.artist); });
        }

        // ---- Alerts ----
        function showAlert(id, msg, type) {
            var el = $(id);
            el.classList.add('show');
            if (type === 'success') {
                el.style.background = 'rgba(39, 103, 73, 0.08)';
                el.style.borderColor = 'var(--success)';
                el.style.color = 'var(--success)';
            } else {
                el.style.background = '';
                el.style.borderColor = '';
                el.style.color = '';
            }
            $(id + '-msg').textContent = msg;
        }
        function hideAlert(id) {
            $(id).classList.remove('show');
        }

        // ---- Sign In ----
        $('signin-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var email = $('signin-email').value.trim();
            var password = $('signin-password').value;
            if (!email || !password) return;
            var btn = $('signin-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Signing in...';
            hideAlert('signin-alert');

            function doLogin() {
                return fetch('/api/artist/login', {
                    method: 'POST',
                    credentials: 'same-origin',
                    headers: csrfHeaders('application/json'),
                    body: JSON.stringify({ email: email, password: password })
                });
            }

            doLogin()
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    if (data.success && data.artist) {
                        setLoggedIn(data.artist);
                    } else if (data.message && data.message.indexOf('csrf') !== -1) {
                        // CSRF token stale — refresh and retry once
                        return fetchCsrfToken().then(doLogin)
                            .then(function(res) { return res.json(); })
                            .then(function(data2) {
                                if (data2.success && data2.artist) {
                                    setLoggedIn(data2.artist);
                                } else {
                                    showAlert('signin-alert', data2.message || 'Sign in failed. Please check your credentials.');
                                }
                            });
                    } else {
                        showAlert('signin-alert', data.message || 'Sign in failed. Please check your credentials.');
                    }
                })
                .catch(function() {
                    showAlert('signin-alert', 'Connection error. Please try again.');
                })
                .finally(function() {
                    btn.disabled = false;
                    btn.textContent = 'Sign In';
                });
        });

        // ---- Create Account ----
        $('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var btn = $('register-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Creating account...';
            hideAlert('register-alert');

            var body = {
                name: $('reg-name').value.trim(),
                email: $('reg-email').value.trim(),
                password: $('reg-password').value
            };
            if (!body.password || body.password.length < 6) {
                showAlert('register-alert', 'Password must be at least 6 characters.');
                btn.disabled = false;
                btn.textContent = 'Create Account';
                return;
            }
            var bio = $('reg-bio').value.trim();
            var loc = $('reg-location').value.trim();
            var port = $('reg-portfolio').value.trim();
            if (bio) body.bio = bio;
            if (loc) body.location = loc;
            if (port) body.portfolio = port;

            fetch('/api/artist/register', {
                method: 'POST',
                credentials: 'same-origin',
                headers: csrfHeaders('application/json'),
                body: JSON.stringify(body)
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.success && data.artist) {
                    setLoggedIn(data.artist);
                } else {
                    showAlert('register-alert', data.error || 'Registration failed. Please try again.');
                }
            })
            .catch(function() {
                showAlert('register-alert', 'Connection error. Please try again.');
            })
            .finally(function() {
                btn.disabled = false;
                btn.textContent = 'Create Account';
            });
        });

        // ---- Submit Artwork ----

        // Character count
        $('art-description').addEventListener('input', function() {
            $('desc-count').textContent = this.value.length;
            updateStrength();
        });
        $('art-process').addEventListener('input', updateStrength);

        // Declaration checkbox
        $('declaration-check').addEventListener('change', function() {
            $('submit-btn').disabled = !this.checked;
        });

        // ---- Artwork image upload ----
        var artworkArea = $('artwork-upload-area');
        var artworkInput = $('artwork-input');

        artworkArea.addEventListener('click', function() { artworkInput.click(); });
        artworkArea.addEventListener('dragover', function(e) { e.preventDefault(); artworkArea.classList.add('dragover'); });
        artworkArea.addEventListener('dragleave', function(e) { e.preventDefault(); artworkArea.classList.remove('dragover'); });
        artworkArea.addEventListener('drop', function(e) {
            e.preventDefault();
            artworkArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) setArtworkFile(e.dataTransfer.files[0]);
        });
        artworkInput.addEventListener('change', function() {
            if (artworkInput.files.length > 0) setArtworkFile(artworkInput.files[0]);
            artworkInput.value = '';
        });

        function setArtworkFile(file) {
            if (!file.type || !(file.type.startsWith('image/') || file.type.startsWith('video/'))) return;
            artworkFile = file;
            renderArtworkThumbnail();
            updateStrength();
        }

        function renderArtworkThumbnail() {
            var container = $('artwork-thumbnail');
            container.innerHTML = '';
            if (!artworkFile) return;

            var thumb = document.createElement('div');
            thumb.className = 'file-thumb';
            if (artworkFile.type && artworkFile.type.startsWith('video/')) {
                var vid = document.createElement('video');
                vid.src = URL.createObjectURL(artworkFile);
                vid.style.maxWidth = '100%';
                vid.style.borderRadius = '6px';
                vid.muted = true;
                vid.playsInline = true;
                vid.autoplay = false;
                vid.controls = true;
                thumb.appendChild(vid);
            } else {
                var img = document.createElement('img');
                img.src = URL.createObjectURL(artworkFile);
                img.alt = artworkFile.name;
                thumb.appendChild(img);
            }

            var removeBtn = document.createElement('button');
            removeBtn.className = 'file-thumb-remove';
            removeBtn.type = 'button';
            removeBtn.innerHTML = '&#10005;';
            removeBtn.addEventListener('click', function() {
                artworkFile = null;
                renderArtworkThumbnail();
                updateStrength();
            });
            thumb.appendChild(removeBtn);
            container.appendChild(thumb);
        }

        // ---- Evidence / WIP upload ----
        var uploadArea = $('upload-area');
        var evidenceInput = $('evidence-input');

        uploadArea.addEventListener('click', function() { evidenceInput.click(); });
        uploadArea.addEventListener('dragover', function(e) { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', function(e) { e.preventDefault(); uploadArea.classList.remove('dragover'); });
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            addFiles(e.dataTransfer.files);
        });

        evidenceInput.addEventListener('change', function() {
            addFiles(evidenceInput.files);
            evidenceInput.value = '';
        });

        function addFiles(fileList) {
            var newFiles = Array.prototype.slice.call(fileList);
            var remaining = 10 - selectedFiles.length;
            var toAdd = newFiles.slice(0, remaining);
            selectedFiles = selectedFiles.concat(toAdd);
            for (var i = 0; i < toAdd.length; i++) evidenceVisibility.push(false);
            renderThumbnails();
            updateStrength();
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            evidenceVisibility.splice(index, 1);
            renderThumbnails();
            updateStrength();
        }

        function renderThumbnails() {
            var container = $('file-thumbnails');
            container.innerHTML = '';

            selectedFiles.forEach(function(file, i) {
                var thumb = document.createElement('div');
                thumb.className = 'file-thumb';

                var preview = document.createElement('div');
                preview.className = 'thumb-preview';

                if (file.type && file.type.startsWith('image/')) {
                    var img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.alt = file.name;
                    preview.appendChild(img);
                } else if (file.type && file.type.startsWith('video/')) {
                    var vid = document.createElement('video');
                    vid.src = URL.createObjectURL(file);
                    vid.style.width = '100%';
                    vid.style.borderRadius = '4px';
                    vid.muted = true;
                    vid.playsInline = true;
                    vid.controls = true;
                    preview.appendChild(vid);
                } else {
                    var icon = document.createElement('div');
                    icon.className = 'file-icon';
                    var sym = document.createElement('span');
                    sym.className = 'file-icon-symbol';
                    icon.appendChild(sym);
                    var ext = file.name.split('.').pop().toUpperCase();
                    icon.appendChild(document.createTextNode(ext));
                    preview.appendChild(icon);
                }

                var removeBtn = document.createElement('button');
                removeBtn.className = 'file-thumb-remove';
                removeBtn.type = 'button';
                removeBtn.innerHTML = '&#10005;';
                removeBtn.setAttribute('data-index', i);
                removeBtn.addEventListener('click', function() {
                    removeFile(parseInt(this.getAttribute('data-index'), 10));
                });
                preview.appendChild(removeBtn);
                thumb.appendChild(preview);

                // Visibility toggle
                var toggle = document.createElement('label');
                toggle.style.cssText = 'display:flex;align-items:center;gap:0.3rem;font-size:0.7rem;color:#888888;padding:0.35rem 0.25rem;cursor:pointer;';
                var cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.checked = evidenceVisibility[i];
                cb.setAttribute('data-index', i);
                cb.addEventListener('change', function() {
                    evidenceVisibility[parseInt(this.getAttribute('data-index'), 10)] = this.checked;
                });
                toggle.appendChild(cb);
                toggle.appendChild(document.createTextNode(' Show on certificate'));
                thumb.appendChild(toggle);

                container.appendChild(thumb);
            });

            $('file-count').textContent = selectedFiles.length > 0
                ? selectedFiles.length + ' of 10 files selected'
                : '';

            // Show/hide visibility explanation when files are present
            var visNote = $('evidence-visibility-note');
            if (visNote) visNote.style.display = selectedFiles.length > 0 ? 'block' : 'none';
        }

        // ---- Writing guidance ----
        var writingMediums = ['Novel/Fiction', 'Non-Fiction', 'Screenplay/Script', 'Poetry', 'Journalism/Article', 'Short Story', 'Essay'];
        $('art-medium').addEventListener('change', function() {
            var guidance = $('writing-guidance');
            guidance.style.display = writingMediums.indexOf(this.value) !== -1 ? 'block' : 'none';
        });

        // Evidence strength meter
        var strengthLabels = [
            'Description >50 chars',
            'Description >200 chars',
            'Process notes',
            '1+ files uploaded',
            '3+ files uploaded',
            '5+ files uploaded'
        ];

        function updateStrength() {
            var descLen = ($('art-description').value || '').length;
            var processLen = ($('art-process').value || '').trim().length;
            var fileCount = selectedFiles.length + (artworkFile ? 1 : 0);

            var score = 0;
            var checks = [];

            var d50 = descLen > 50;
            checks.push(d50);
            if (d50) score++;

            var d200 = descLen > 200;
            checks.push(d200);
            if (d200) score++;

            var pn = processLen > 0;
            checks.push(pn);
            if (pn) score++;

            var f1 = fileCount >= 1;
            checks.push(f1);
            if (f1) score++;

            var f3 = fileCount >= 3;
            checks.push(f3);
            if (f3) score++;

            var f5 = fileCount >= 5;
            checks.push(f5);
            if (f5) score += 2;

            var tier, tierLabel;
            if (score >= 5) { tier = 'gold'; tierLabel = 'Gold'; }
            else if (score >= 3) { tier = 'silver'; tierLabel = 'Silver'; }
            else { tier = 'bronze'; tierLabel = 'Bronze'; }

            var tierEl = $('strength-tier');
            tierEl.textContent = tierLabel;
            tierEl.className = 'strength-tier tier-' + tier;

            var maxScore = 7;
            var pct = Math.min((score / maxScore) * 100, 100);
            var fill = $('strength-fill');
            fill.style.width = pct + '%';
            fill.className = 'strength-bar-fill tier-' + tier;

            var detailsHtml = '';
            for (var i = 0; i < checks.length; i++) {
                var done = checks[i];
                detailsHtml += '<span class="strength-item">' +
                    '<span class="strength-check ' + (done ? 'done' : 'pending') + '">' +
                    (done ? '&#10003;' : '&#9675;') + '</span> ' +
                    strengthLabels[i] + '</span>';
            }
            $('strength-details').innerHTML = detailsHtml;
        }

        // Submit form
        $('submit-form').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!currentArtist) return;

            var btn = $('submit-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Submitting...';
            hideAlert('submit-alert');

            var formData = new FormData();
            formData.append('title', $('art-title').value.trim());
            formData.append('medium', $('art-medium').value);
            formData.append('creationDate', $('art-date').value);
            formData.append('description', $('art-description').value.trim());
            formData.append('processNotes', $('art-process').value.trim());
            formData.append('declaration', 'true');

            if (artworkFile) {
                formData.append('artworkImage', artworkFile);
            }
            selectedFiles.forEach(function(file) {
                formData.append('evidence', file);
            });
            formData.append('evidenceVisibility', JSON.stringify(evidenceVisibility));

            fetch('/api/artwork/submit', {
                method: 'POST',
                credentials: 'same-origin',
                headers: csrfToken ? { 'X-CSRF-Token': csrfToken } : {},
                body: formData
            })
            .then(function(res) { return res.json().then(function(d) { d._status = res.status; return d; }); })
            .then(function(data) {
                if (data.success && data.certificate) {
                    showSuccessCard(data.certificate);
                    $('submit-form').reset();
                    artworkFile = null;
                    selectedFiles = [];
                    evidenceVisibility = [];
                    renderArtworkThumbnail();
                    renderThumbnails();
                    updateStrength();
                    $('desc-count').textContent = '0';
                    $('submit-btn').disabled = true;
                    if (currentArtist) loadPlanInfo(currentArtist.id);
                    switchTab('dashboard');
                } else if (data.limitReached) {
                    showAlert('submit-alert', data.message);
                    if (currentArtist) loadPlanInfo(currentArtist.id);
                    btn.disabled = !$('declaration-check').checked;
                } else {
                    showAlert('submit-alert', data.message || data.error || 'Submission failed. Please try again.');
                    btn.disabled = !$('declaration-check').checked;
                }
            })
            .catch(function() {
                showAlert('submit-alert', 'Connection error. Please try again.');
                btn.disabled = !$('declaration-check').checked;
            })
            .finally(function() {
                btn.textContent = 'Submit for Certification';
            });
        });

        // ---- Success Card ----
        function showSuccessCard(cert) {
            var card = $('success-card');
            var details = $('success-details');
            var actions = $('success-actions');
            var tierClass = (cert.tier || 'bronze').toLowerCase();
            var tierStyles = {
                gold: { bg: '#ebe5da', color: '#1a1a1a' },
                silver: { bg: '#e8edf2', color: '#888888' },
                bronze: { bg: '#f0e6d8', color: '#666666' }
            };
            var ts = tierStyles[tierClass] || tierStyles.bronze;

            details.innerHTML =
                '<div class="success-detail-item">' +
                    '<span class="success-detail-label">Title</span>' +
                    '<span class="success-detail-value">' + escHtml(cert.title) + '</span>' +
                '</div>' +
                '<div class="success-detail-item">' +
                    '<span class="success-detail-label">Certificate ID</span>' +
                    '<span class="success-detail-value">' +
                        '<a href="verify.html?code=' + encodeURIComponent(cert.id) + '" style="color:var(--navy);font-family:monospace;letter-spacing:0.04em;text-decoration:none;">' +
                            escHtml(cert.id) +
                        '</a>' +
                    '</span>' +
                '</div>' +
                '<div class="success-detail-item">' +
                    '<span class="success-detail-label">Medium</span>' +
                    '<span class="success-detail-value">' + escHtml(cert.medium) + '</span>' +
                '</div>' +
                '<div class="success-detail-item">' +
                    '<span class="success-detail-label">Tier</span>' +
                    '<span class="success-detail-value"><span class="tier-badge tier-' + tierClass + '">' + escHtml(cert.tier) + '</span></span>' +
                '</div>' +
                // Certificate card for download
                '<div id="cert-card-wrap" style="margin-top:1.5rem;">' +
                    '<p style="font-size:0.82rem;color:#888888;margin-bottom:0.75rem;">Share this certificate card:</p>' +
                    '<div id="certificate-card" style="width:600px;max-width:100%;background:#fff;border:2px solid #1a1a1a;border-radius:12px;overflow:hidden;margin:0 auto;">' +
                        '<div style="background:#1a1a1a;color:#f5f0e8;padding:1.25rem 1.5rem;text-align:center;">' +
                            '<div style="font-family:Inter,sans-serif;font-size:1.2rem;font-weight:600;color:#1a1a1a;"><span style="font-weight:300;color:#666666;">officially</span><span style="font-weight:600;">human</span><span style="font-weight:700;font-size:1.5rem;">.art</span></div>' +
                            '<div style="font-size:0.72rem;text-transform:uppercase;letter-spacing:0.12em;opacity:0.8;margin-top:0.25rem;">Certificate of Human Creation</div>' +
                        '</div>' +
                        '<div style="padding:1.5rem;text-align:center;">' +
                            '<div style="font-family:Inter,sans-serif;font-size:1.3rem;color:#1a1a1a;margin-bottom:0.25rem;">' + escHtml(cert.title) + '</div>' +
                            '<div style="color:#888888;font-size:0.9rem;margin-bottom:1rem;">by ' + escHtml(currentArtist ? currentArtist.name : '') + '</div>' +
                            '<div style="display:inline-block;padding:0.3rem 1rem;border-radius:100px;font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;margin-bottom:1rem;background:' + ts.bg + ';color:' + ts.color + ';">' +
                                escHtml(cert.tierLabel || cert.tier || 'Bronze') + ' Certification</div>' +
                            '<div style="display:flex;align-items:center;justify-content:center;gap:1.5rem;margin-top:0.5rem;">' +
                                '<img id="card-qr" alt="QR Code" style="width:120px;height:120px;border-radius:6px;background:#ebe5da;">' +
                                '<div style="text-align:left;">' +
                                    '<div style="font-size:0.68rem;text-transform:uppercase;letter-spacing:0.1em;color:#a0aec0;margin-bottom:0.2rem;">Certificate ID</div>' +
                                    '<div style="font-family:monospace;font-size:1rem;letter-spacing:0.08em;color:#1a1a1a;font-weight:600;">' + escHtml(cert.id) + '</div>' +
                                    '<div style="font-size:0.68rem;text-transform:uppercase;letter-spacing:0.1em;color:#a0aec0;margin-top:0.75rem;margin-bottom:0.2rem;">Verify at</div>' +
                                    '<div style="font-size:0.8rem;color:#1a1a1a;">' + escHtml(location.host) + '/verify</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                        '<div style="background:#ebe5da;padding:0.6rem;text-align:center;font-size:0.7rem;color:#a0aec0;border-top:1px solid rgba(26,26,26,0.06);">' +
                            'Verified Human Creation' +
                        '</div>' +
                    '</div>' +
                '</div>';

            // Fetch QR code for the card
            fetch('/api/qr/' + encodeURIComponent(cert.id))
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    if (data.success && data.qrCode) {
                        var qrImg = $('card-qr');
                        if (qrImg) qrImg.src = data.qrCode;
                    }
                });

            actions.innerHTML =
                '<button type="button" class="btn btn-gold btn-sm" id="download-card-btn">Download Certificate Card</button>' +
                '<a href="verify.html?code=' + encodeURIComponent(cert.id) + '" class="btn btn-sm" target="_blank">View Certificate</a>' +
                '<button type="button" class="btn btn-sm btn-outline" id="submit-another-btn">Submit Another</button>';

            card.classList.add('show');

            // Bind buttons after rendering
            setTimeout(function() {
                var sa = $('submit-another-btn');
                if (sa) sa.addEventListener('click', function() { switchTab('submit'); });

                var dl = $('download-card-btn');
                if (dl) dl.addEventListener('click', function() { downloadCertificateCard(cert); });
            }, 0);
        }

        function downloadCertificateCard(cert) {
            var tierClass = (cert.tier || 'bronze').toLowerCase();
            var tierLabel = (cert.tierLabel || cert.tier || 'Bronze').toUpperCase();
            var tierColors = { gold: '#a08530', silver: '#6b7280', bronze: '#a0764a' };
            var tierBgs = { gold: '#faf3e0', silver: '#edf0f4', bronze: '#f5ebe0' };
            var tierColor = tierColors[tierClass] || tierColors.bronze;
            var tierBg = tierBgs[tierClass] || tierBgs.bronze;

            var W = 1200;
            var H = 1500;
            var canvas = document.createElement('canvas');
            canvas.width = W;
            canvas.height = H;
            var ctx = canvas.getContext('2d');

            function drawCard() {
                // Background
                ctx.fillStyle = '#f5f0e8';
                ctx.fillRect(0, 0, W, H);

                // Navy header
                ctx.fillStyle = '#2a2520';
                ctx.fillRect(0, 0, W, 140);
                ctx.fillStyle = '#f5f0e8';
                ctx.font = 'bold 52px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Officially Human Art', W / 2, 70);
                ctx.font = '18px sans-serif';
                ctx.fillStyle = 'rgba(245,240,232,0.7)';
                ctx.fillText('CERTIFICATE OF HUMAN CREATION', W / 2, 115);

                // Artwork area (square, centred)
                var artY = 180;
                var artSize = 700;
                var artX = (W - artSize) / 2;

                ctx.fillStyle = '#ebe5da';
                ctx.fillRect(artX, artY, artSize, artSize);

                // Draw artwork image if loaded
                if (artworkImg && artworkImg.complete && artworkImg.naturalWidth > 0) {
                    // Cover-fit the image
                    var iw = artworkImg.naturalWidth;
                    var ih = artworkImg.naturalHeight;
                    var scale = Math.max(artSize / iw, artSize / ih);
                    var sw = artSize / scale;
                    var sh = artSize / scale;
                    var sx = (iw - sw) / 2;
                    var sy = (ih - sh) / 2;
                    ctx.save();
                    ctx.beginPath();
                    ctx.rect(artX, artY, artSize, artSize);
                    ctx.clip();
                    ctx.drawImage(artworkImg, sx, sy, sw, sh, artX, artY, artSize, artSize);
                    ctx.restore();

                    // Watermark overlay
                    ctx.save();
                    ctx.globalAlpha = 0.12;
                    ctx.translate(artX + artSize / 2, artY + artSize / 2);
                    ctx.rotate(-30 * Math.PI / 180);
                    ctx.fillStyle = '#1a1a1a';
                    ctx.font = 'bold 36px Inter, sans-serif';
                    ctx.textAlign = 'center';
                    for (var wy = -artSize; wy < artSize; wy += 120) {
                        for (var wx = -artSize; wx < artSize; wx += 380) {
                            ctx.fillText('Officially Human Art', wx, wy);
                        }
                    }
                    ctx.restore();
                } else {
                    // Placeholder
                    ctx.fillStyle = '#a0aec0';
                    ctx.font = '48px Inter, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('OH', artX + artSize / 2, artY + artSize / 2 + 16);
                }

                // Border around artwork
                ctx.strokeStyle = 'rgba(26,26,26,0.1)';
                ctx.lineWidth = 2;
                ctx.strokeRect(artX, artY, artSize, artSize);

                // Details section below artwork
                var detailsY = artY + artSize + 50;

                // Title
                ctx.fillStyle = '#1a1a1a';
                ctx.font = 'bold 42px Inter, sans-serif';
                ctx.textAlign = 'center';
                // Truncate long titles
                var title = cert.title || 'Untitled';
                if (ctx.measureText(title).width > W - 120) {
                    while (ctx.measureText(title + '...').width > W - 120 && title.length > 0) {
                        title = title.slice(0, -1);
                    }
                    title += '...';
                }
                ctx.fillText(title, W / 2, detailsY);

                // Artist
                ctx.fillStyle = '#666666';
                ctx.font = '24px sans-serif';
                ctx.fillText('by ' + (currentArtist ? currentArtist.name : ''), W / 2, detailsY + 40);

                // Medium
                if (cert.medium) {
                    ctx.fillStyle = '#888888';
                    ctx.font = '20px sans-serif';
                    ctx.fillText(cert.medium, W / 2, detailsY + 72);
                }

                // Tier badge
                var badgeY = detailsY + 110;
                var badgeText = tierLabel + ' CERTIFICATION';
                ctx.font = 'bold 18px sans-serif';
                var badgeW = ctx.measureText(badgeText).width + 40;
                // Badge background
                ctx.fillStyle = tierBg;
                ctx.beginPath();
                var bx = (W - badgeW) / 2;
                ctx.roundRect(bx, badgeY - 20, badgeW, 36, 18);
                ctx.fill();
                ctx.fillStyle = tierColor;
                ctx.textAlign = 'center';
                ctx.fillText(badgeText, W / 2, badgeY + 2);

                // Bottom section — QR + cert ID
                var bottomY = H - 220;

                // Divider line
                ctx.strokeStyle = 'rgba(26,26,26,0.08)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(100, bottomY);
                ctx.lineTo(W - 100, bottomY);
                ctx.stroke();

                // QR code (left)
                var qrImg = $('card-qr');
                if (qrImg && qrImg.src && qrImg.complete) {
                    try { ctx.drawImage(qrImg, 100, bottomY + 20, 160, 160); } catch(e) {}
                }

                // Cert ID (right of QR)
                ctx.textAlign = 'left';
                ctx.fillStyle = '#a0aec0';
                ctx.font = '14px sans-serif';
                ctx.fillText('CERTIFICATE ID', 300, bottomY + 50);
                ctx.fillStyle = '#1a1a1a';
                ctx.font = 'bold 26px monospace';
                ctx.fillText(cert.id, 300, bottomY + 82);

                ctx.fillStyle = '#a0aec0';
                ctx.font = '14px sans-serif';
                ctx.fillText('VERIFY AT', 300, bottomY + 120);
                ctx.fillStyle = '#1a1a1a';
                ctx.font = '18px sans-serif';
                ctx.fillText(location.host + '/verify', 300, bottomY + 146);

                // Footer bar
                ctx.fillStyle = '#ebe5da';
                ctx.fillRect(0, H - 50, W, 50);
                ctx.fillStyle = '#a0aec0';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Verified Human Creation  \u00b7  officiallyhuman.art', W / 2, H - 20);

                // Download
                var link = document.createElement('a');
                link.download = cert.id + '-certificate.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }

            // Load artwork image then draw
            var artworkImg = new Image();
            artworkImg.crossOrigin = 'anonymous';
            if (cert.artworkImage) {
                artworkImg.onload = drawCard;
                artworkImg.onerror = drawCard;
                artworkImg.src = '/uploads/' + cert.artworkImage;
            } else {
                drawCard();
            }
        }

        // ---- Load Certificates ----
        function loadCertificates() {
            if (!currentArtist) return;

            var list = $('cert-list');
            var empty = $('empty-state');
            var header = $('dashboard-title');

            list.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--ink-faint);"><span class="spinner spinner-dark"></span><br>Loading certificates...</div>';
            empty.style.display = 'none';

            fetch('/api/artist/' + encodeURIComponent(currentArtist.id) + '/certificates')
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    if (data.success && data.certificates && data.certificates.length > 0) {
                        var certs = data.certificates;
                        header.innerHTML = 'My Certificates <small>' + certs.length + ' certified work' + (certs.length !== 1 ? 's' : '') + '</small>';
                        list.innerHTML = '';
                        certs.forEach(function(cert) {
                            list.appendChild(createCertItem(cert));
                        });
                        empty.style.display = 'none';
                    } else {
                        header.innerHTML = 'My Certificates <small>No certificates yet</small>';
                        list.innerHTML = '';
                        empty.style.display = 'block';
                    }
                })
                .catch(function() {
                    header.innerHTML = 'My Certificates';
                    list.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--error);">Failed to load certificates. Please try again.</div>';
                });
        }

        function createCertItem(cert) {
            var tierClass = (cert.tier || 'bronze').toLowerCase();
            var dateStr = '';
            if (cert.registeredAt) {
                dateStr = new Date(cert.registeredAt).toLocaleDateString('en-GB', {
                    day: 'numeric', month: 'short', year: 'numeric'
                });
            }

            var certId = escHtml(cert.id);
            var origin = location.origin;

            var htmlEmbed = '<a href="' + origin + '/verify.html?code=' + certId + '"><img src="' + origin + '/api/badge/' + certId + '" alt="Officially Human Art Certified" /></a>';
            var mdEmbed = '[![Officially Human Art Certified](' + origin + '/api/badge/' + certId + ')](' + origin + '/verify.html?code=' + certId + ')';

            var item = document.createElement('div');
            item.className = 'cert-item';
            item.innerHTML =
                '<div class="cert-item-info">' +
                    '<div class="cert-item-title">' + escHtml(cert.title) + '</div>' +
                    '<div class="cert-item-meta">' +
                        '<span>' + escHtml(cert.medium || '') + '</span>' +
                        (dateStr ? '<span>Registered ' + dateStr + '</span>' : '') +
                        '<a href="verify.html?code=' + encodeURIComponent(cert.id) + '">' + certId + '</a>' +
                    '</div>' +
                '</div>' +
                '<div class="cert-item-actions">' +
                    '<span class="tier-badge tier-' + tierClass + '">' + escHtml(cert.tier || 'Bronze') + '</span>' +
                    '<a href="verify.html?code=' + encodeURIComponent(cert.id) + '" class="cert-action-btn" target="_blank">View</a>' +
                    '<button type="button" class="cert-action-btn edit-cert-btn" data-cert-id="' + certId + '" data-cert-title="' + escHtml(cert.title) + '" data-cert-desc="' + escHtml(cert.description || '') + '" data-cert-notes="' + escHtml(cert.processNotes || '') + '">Edit</button>' +
                    '<button type="button" class="cert-action-btn delete-btn delete-cert-btn" data-cert-id="' + certId + '" data-cert-title="' + escHtml(cert.title) + '">Withdraw</button>' +
                    '<div class="embed-wrap">' +
                        '<button type="button" class="btn btn-sm btn-outline embed-toggle-btn" data-cert-id="' + certId + '">Get Embed Code</button>' +
                        '<div class="embed-dropdown" id="embed-' + certId + '">' +
                            '<h4>Embed Code</h4>' +
                            '<div class="embed-section">' +
                                '<span class="embed-section-label">HTML</span>' +
                                '<div class="embed-code-box">' +
                                    '<code id="html-code-' + certId + '"></code>' +
                                    '<button type="button" class="copy-btn" data-target="html-code-' + certId + '">Copy</button>' +
                                '</div>' +
                            '</div>' +
                            '<div class="embed-section">' +
                                '<span class="embed-section-label">Markdown</span>' +
                                '<div class="embed-code-box">' +
                                    '<code id="md-code-' + certId + '"></code>' +
                                    '<button type="button" class="copy-btn" data-target="md-code-' + certId + '">Copy</button>' +
                                '</div>' +
                            '</div>' +
                            '<div class="embed-section">' +
                                '<span class="embed-section-label">Badge Preview</span>' +
                                '<div class="embed-badge-preview">' +
                                    '<img src="/api/badge/' + certId + '" alt="Officially Human Art Badge" onerror="this.style.display=\'none\';this.parentElement.insertAdjacentHTML(\'beforeend\',\'<span style=color:var(--ink-faint);font-size:0.8rem>Badge preview unavailable</span>\')">' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';

            // Set code content as text (not HTML) to avoid XSS
            setTimeout(function() {
                var htmlCode = document.getElementById('html-code-' + certId);
                var mdCode = document.getElementById('md-code-' + certId);
                if (htmlCode) htmlCode.textContent = htmlEmbed;
                if (mdCode) mdCode.textContent = mdEmbed;
            }, 0);

            return item;
        }

        // ---- Embed Toggle (event delegation) ----
        document.addEventListener('click', function(e) {
            var toggle = e.target.closest('.embed-toggle-btn');
            if (toggle) {
                e.stopPropagation();
                var certId = toggle.getAttribute('data-cert-id');
                var dropdown = document.getElementById('embed-' + certId);
                // Close all other dropdowns
                document.querySelectorAll('.embed-dropdown.show').forEach(function(d) {
                    if (d !== dropdown) d.classList.remove('show');
                });
                if (dropdown) dropdown.classList.toggle('show');
                return;
            }

            // Copy button
            var copyBtn = e.target.closest('.copy-btn');
            if (copyBtn) {
                e.stopPropagation();
                var targetId = copyBtn.getAttribute('data-target');
                var codeEl = document.getElementById(targetId);
                if (!codeEl) return;
                var text = codeEl.textContent;

                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(function() {
                        copyBtn.textContent = 'Copied!';
                        copyBtn.classList.add('copied');
                        setTimeout(function() {
                            copyBtn.textContent = 'Copy';
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    });
                } else {
                    var ta = document.createElement('textarea');
                    ta.value = text;
                    ta.style.position = 'fixed';
                    ta.style.opacity = '0';
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                    copyBtn.textContent = 'Copied!';
                    copyBtn.classList.add('copied');
                    setTimeout(function() {
                        copyBtn.textContent = 'Copy';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                }
                return;
            }

            // Close dropdowns on outside click
            if (!e.target.closest('.embed-dropdown')) {
                document.querySelectorAll('.embed-dropdown.show').forEach(function(d) {
                    d.classList.remove('show');
                });
            }
        });

        // ---- Delete Certificate ----
        var deleteCertId = null;

        document.addEventListener('click', function(e) {
            var delBtn = e.target.closest('.delete-cert-btn');
            if (delBtn) {
                deleteCertId = delBtn.getAttribute('data-cert-id');
                $('delete-cert-title').textContent = delBtn.getAttribute('data-cert-title');
                $('delete-modal').classList.add('show');
            }
        });

        $('delete-modal-close').addEventListener('click', function() { $('delete-modal').classList.remove('show'); });
        $('delete-cancel-btn').addEventListener('click', function() { $('delete-modal').classList.remove('show'); });

        $('delete-confirm-btn').addEventListener('click', function() {
            if (!deleteCertId || !currentArtist) return;
            var btn = this;
            btn.disabled = true;
            btn.textContent = 'Withdrawing...';

            fetch('/api/artwork/' + encodeURIComponent(deleteCertId), {
                method: 'DELETE',
                credentials: 'same-origin',
                headers: csrfHeaders()
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.success) {
                    $('delete-modal').classList.remove('show');
                    loadCertificates();
                    if (currentArtist) loadPlanInfo(currentArtist.id);
                } else {
                    alert(data.message || 'Failed to withdraw certificate.');
                }
            })
            .catch(function() { alert('Connection error. Please try again.'); })
            .finally(function() {
                btn.disabled = false;
                btn.textContent = 'Withdraw';
            });
        });

        // ---- Edit Certificate ----
        var editCertId = null;

        document.addEventListener('click', function(e) {
            var editBtn = e.target.closest('.edit-cert-btn');
            if (editBtn) {
                editCertId = editBtn.getAttribute('data-cert-id');
                $('edit-title').value = editBtn.getAttribute('data-cert-title') || '';
                $('edit-description').value = editBtn.getAttribute('data-cert-desc') || '';
                $('edit-process-notes').value = editBtn.getAttribute('data-cert-notes') || '';
                var editAlert = $('edit-alert');
                if (editAlert) editAlert.style.display = 'none';
                $('edit-modal').classList.add('show');
            }
        });

        $('edit-modal-close').addEventListener('click', function() { $('edit-modal').classList.remove('show'); });
        $('edit-cancel-btn').addEventListener('click', function() { $('edit-modal').classList.remove('show'); });

        $('edit-save-btn').addEventListener('click', function() {
            if (!editCertId || !currentArtist) return;
            var title = $('edit-title').value.trim();
            if (!title) {
                $('edit-alert-msg').textContent = 'Title is required.';
                $('edit-alert').style.display = 'flex';
                return;
            }

            var btn = this;
            btn.disabled = true;
            btn.textContent = 'Saving...';

            fetch('/api/artwork/' + encodeURIComponent(editCertId), {
                method: 'PUT',
                credentials: 'same-origin',
                headers: csrfHeaders('application/json'),
                body: JSON.stringify({
                    title: title,
                    description: $('edit-description').value.trim(),
                    processNotes: $('edit-process-notes').value.trim()
                })
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.success) {
                    $('edit-modal').classList.remove('show');
                    loadCertificates();
                } else {
                    $('edit-alert-msg').textContent = data.message || 'Failed to save changes.';
                    $('edit-alert').style.display = 'flex';
                }
            })
            .catch(function() {
                $('edit-alert-msg').textContent = 'Connection error. Please try again.';
                $('edit-alert').style.display = 'flex';
            })
            .finally(function() {
                btn.disabled = false;
                btn.textContent = 'Save Changes';
            });
        });

        // ---- Delete Account ----
        $('delete-account-btn').addEventListener('click', function() {
            $('delete-account-password').value = '';
            var alert = $('delete-account-alert');
            if (alert) alert.style.display = 'none';
            $('delete-account-modal').classList.add('show');
        });

        $('delete-account-modal-close').addEventListener('click', function() { $('delete-account-modal').classList.remove('show'); });
        $('delete-account-cancel-btn').addEventListener('click', function() { $('delete-account-modal').classList.remove('show'); });

        $('delete-account-confirm-btn').addEventListener('click', function() {
            if (!currentArtist) return;
            var password = $('delete-account-password').value;
            if (!password) {
                $('delete-account-alert-msg').textContent = 'Please enter your password.';
                $('delete-account-alert').style.display = 'flex';
                return;
            }

            var btn = this;
            btn.disabled = true;
            btn.textContent = 'Deleting...';

            fetch('/api/artist/' + encodeURIComponent(currentArtist.id), {
                method: 'DELETE',
                credentials: 'same-origin',
                headers: csrfHeaders('application/json'),
                body: JSON.stringify({ password: password })
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.success) {
                    $('delete-account-modal').classList.remove('show');
                    signOut();
                    showAlert('signin-alert', 'Your account has been deleted.');
                } else {
                    $('delete-account-alert-msg').textContent = data.message || 'Failed to delete account.';
                    $('delete-account-alert').style.display = 'flex';
                }
            })
            .catch(function() {
                $('delete-account-alert-msg').textContent = 'Connection error. Please try again.';
                $('delete-account-alert').style.display = 'flex';
            })
            .finally(function() {
                btn.disabled = false;
                btn.textContent = 'Delete My Account';
            });
        });

        // ---- Plan Management ----
        function loadPlanInfo(artistId) {
            fetch('/api/artist/plan/' + encodeURIComponent(artistId))
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    if (data.success) {
                        currentPlan = data;
                        updatePlanUI();
                    }
                });
        }

        function updatePlanUI() {
            if (!currentPlan) return;

            var badge = $('plan-badge');
            if (badge) {
                if (currentPlan.plan === 'creator') {
                    badge.innerHTML = '<span style="display:inline-flex;align-items:center;padding:0.2rem 0.6rem;background:var(--gold-pale);color:var(--gold);border-radius:100px;font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;">Creator</span>';
                } else {
                    badge.innerHTML = '<span style="display:inline-flex;align-items:center;padding:0.2rem 0.6rem;background:rgba(26,26,26,0.06);color:var(--ink-faint);border-radius:100px;font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;">Free</span>';
                }
            }

            var counter = $('work-counter');
            if (counter) {
                counter.style.display = 'block';
                if (currentPlan.plan === 'free') {
                    counter.textContent = currentPlan.certificateCount + ' of ' + currentPlan.certificateLimit + ' works used';
                    counter.style.color = currentPlan.certificateCount >= currentPlan.certificateLimit ? 'var(--error)' : 'var(--ink-faint)';
                } else {
                    counter.textContent = currentPlan.certificateCount + ' work' + (currentPlan.certificateCount !== 1 ? 's' : '') + ' certified (unlimited)';
                    counter.style.color = 'var(--success)';
                }
            }

            var upgradeSection = $('upgrade-section');
            var managePlan = $('manage-plan-section');
            if (upgradeSection) upgradeSection.style.display = currentPlan.plan === 'free' ? 'block' : 'none';
            if (managePlan) {
                managePlan.style.display = currentPlan.plan === 'creator' ? 'block' : 'none';
                var cancelBtn = $('cancel-plan-btn');
                if (currentPlan.planStatus === 'canceling') {
                    var msg = 'Your Creator plan will cancel at the end of your billing period. After that, you\'ll be on the Free plan.';
                    if (currentPlan.planExpiresAt) {
                        var d = new Date(currentPlan.planExpiresAt).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
                        msg = 'Your Creator plan is active until ' + d + '. After that, you\'ll be on the Free plan.';
                    }
                    $('plan-status-text').textContent = msg;
                    if (cancelBtn) cancelBtn.style.display = 'none';
                } else {
                    $('plan-status-text').textContent = 'Your Creator plan is active.';
                    if (cancelBtn) cancelBtn.style.display = '';
                }
            }

            // Show/hide submit form vs limit blocker
            var blocker = $('limit-blocker');
            var submitCard = $('submit-card');
            if (blocker && submitCard) {
                if (currentPlan.plan === 'free' && currentPlan.certificateCount >= currentPlan.certificateLimit) {
                    blocker.style.display = 'block';
                    submitCard.style.display = 'none';
                } else {
                    blocker.style.display = 'none';
                    submitCard.style.display = '';
                }
            }
        }

        // ---- Stripe Payment Flow ----
        // Init Stripe
        fetch('/api/config')
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.stripePublishableKey) {
                    stripeInstance = Stripe(data.stripePublishableKey);
                }
            });

        function openPaymentModal() {
            var modal = $('payment-modal');
            modal.style.display = 'flex';
            $('payment-alert').style.display = 'none';

            if (stripeInstance && !stripeElements) {
                stripeElements = stripeInstance.elements();
                var cardElement = stripeElements.create('card', {
                    style: {
                        base: {
                            fontFamily: "'Inter', sans-serif",
                            fontSize: '16px',
                            color: '#1a1a1a',
                            '::placeholder': { color: '#a0aec0' }
                        },
                        invalid: { color: '#c53030' }
                    }
                });
                cardElement.mount('#stripe-card-element');
            }
        }

        function closePaymentModal() {
            $('payment-modal').style.display = 'none';
            $('payment-alert').style.display = 'none';
        }

        // Upgrade buttons
        $('upgrade-btn').addEventListener('click', openPaymentModal);
        $('upgrade-from-blocker').addEventListener('click', openPaymentModal);
        $('payment-modal-close').addEventListener('click', closePaymentModal);

        // Buy single credit
        $('buy-credit-btn').addEventListener('click', function() {
            var btn = $('buy-credit-btn');
            btn.disabled = true;
            btn.textContent = 'Redirecting...';
            fetch('/api/stripe/buy-credit', {
                method: 'POST',
                headers: csrfHeaders('application/json'),
                credentials: 'include'
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.success && data.url) {
                    window.location.href = data.url;
                } else {
                    alert(data.message || 'Could not start payment. Please try again.');
                    btn.disabled = false;
                    btn.textContent = 'Buy 1 Credit \u2014 \u00A32';
                }
            })
            .catch(function() {
                alert('Connection error. Please try again.');
                btn.disabled = false;
                btn.textContent = 'Buy 1 Credit \u2014 \u00A32';
            });
        });

        // Payment submit
        $('payment-submit-btn').addEventListener('click', function() {
            if (!currentArtist || !stripeInstance || !stripeElements) return;

            var btn = $('payment-submit-btn');
            btn.disabled = true;
            btn.textContent = 'Processing...';
            $('payment-alert').style.display = 'none';

            fetch('/api/stripe/create-subscription', {
                method: 'POST',
                credentials: 'same-origin',
                headers: csrfHeaders('application/json'),
                body: JSON.stringify({})
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (!data.success) {
                    throw new Error(data.message || 'Failed to create subscription');
                }
                // Subscription already active (e.g. free trial) — no payment needed
                if (data.active) {
                    closePaymentModal();
                    currentPlan.plan = 'creator';
                    currentPlan.planStatus = 'active';
                    currentPlan.certificateLimit = null;
                    updatePlanUI();
                    loadPlanInfo(currentArtist.id);
                    return null;
                }
                // Fallback to Stripe Checkout
                if (data.checkoutUrl) {
                    window.location.href = data.checkoutUrl;
                    return null;
                }
                if (!data.clientSecret) {
                    throw new Error('No payment secret returned. Please refresh and try again.');
                }
                return stripeInstance.confirmCardPayment(data.clientSecret, {
                    payment_method: {
                        card: stripeElements.getElement('card'),
                        billing_details: { name: currentArtist.name, email: currentArtist.email }
                    }
                });
            })
            .then(function(result) {
                if (!result) return; // Already handled (active subscription)
                if (result.error) {
                    throw new Error(result.error.message);
                }
                if (result.paymentIntent.status === 'succeeded') {
                    closePaymentModal();
                    currentPlan.plan = 'creator';
                    currentPlan.planStatus = 'active';
                    currentPlan.certificateLimit = null;
                    updatePlanUI();
                    loadPlanInfo(currentArtist.id);
                }
            })
            .catch(function(err) {
                $('payment-alert').style.display = 'flex';
                $('payment-alert-msg').textContent = err.message || 'Payment failed. Please try again.';
            })
            .finally(function() {
                btn.disabled = false;
                btn.textContent = 'Subscribe \u2014 \u00A35/month';
            });
        });

        // Cancel plan
        $('cancel-plan-btn').addEventListener('click', function() {
            if (!currentArtist) return;
            if (!confirm('Are you sure you want to cancel your Creator plan? You\'ll keep access until the end of your billing period.')) return;

            var btn = $('cancel-plan-btn');
            btn.disabled = true;
            btn.textContent = 'Canceling...';

            fetch('/api/stripe/cancel-subscription', {
                method: 'POST',
                credentials: 'same-origin',
                headers: csrfHeaders('application/json'),
                body: JSON.stringify({})
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.success) {
                    currentPlan.planStatus = 'canceling';
                    currentPlan.planExpiresAt = data.planExpiresAt || null;
                    updatePlanUI();
                    loadPlanInfo(currentArtist.id);
                } else {
                    alert(data.message || 'Failed to cancel subscription.');
                    btn.disabled = false;
                    btn.textContent = 'Cancel Plan';
                }
            })
            .catch(function() {
                alert('Connection error. Please try again.');
                btn.disabled = false;
                btn.textContent = 'Cancel Plan';
            });
        });

        // ---- Session Restore ----
        function fetchCsrfToken() {
            return fetch('/api/csrf-token', { credentials: 'same-origin' })
                .then(function(res) { return res.json(); })
                .then(function(data) { if (data.token) { csrfToken = data.token; window._pageCsrfToken = data.token; } });
        }

        function restoreSession() {
            fetch('/api/artist/me', { credentials: 'same-origin' })
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    if (data.success && data.artist) {
                        setLoggedIn(data.artist);
                        // Show success message if returning from credit purchase
                        var params = new URLSearchParams(window.location.search);
                        if (params.get('credit_purchased') === '1') {
                            switchTab('submit');
                            showAlert('submit-alert', 'Certificate credit added! You can now submit another work.', 'success');
                            window.history.replaceState({}, '', 'register.html');
                        }
                        if (params.get('subscribed') === '1') {
                            switchTab('submit');
                            showAlert('submit-alert', 'Creator plan activated! You now have unlimited certificates.', 'success');
                            window.history.replaceState({}, '', 'register.html');
                        }
                    }
                })
                .catch(function() {});
        }

        fetchCsrfToken().then(restoreSession);

        // ---- Init ----
        $('art-date').value = new Date().toISOString().split('T')[0];
        updateStrength();

        // ---- Password Reset ----
        var signinForm = $('signin-form');
        var forgotWrap = $('forgot-form-wrap');
        var resetWrap = $('reset-form-wrap');

        $('forgot-password-link').addEventListener('click', function(e) {
            e.preventDefault();
            signinForm.style.display = 'none';
            forgotWrap.style.display = 'block';
            resetWrap.style.display = 'none';
        });

        $('back-to-signin-link').addEventListener('click', function(e) {
            e.preventDefault();
            signinForm.style.display = 'block';
            forgotWrap.style.display = 'none';
        });

        $('forgot-submit-btn').addEventListener('click', function() {
            var email = $('forgot-email').value.trim();
            if (!email) return;
            var btn = this;
            btn.disabled = true;
            btn.textContent = 'Sending...';
            var alertEl = $('forgot-alert');
            alertEl.style.display = 'none';

            fetch('/api/artist/forgot-password', {
                method: 'POST',
                credentials: 'same-origin',
                headers: csrfHeaders('application/json'),
                body: JSON.stringify({ email: email })
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                $('forgot-alert-msg').textContent = data.message;
                alertEl.className = 'alert ' + (data.success ? 'alert-success' : 'alert-error');
                alertEl.style.display = 'flex';
                alertEl.style.background = data.success ? 'rgba(39,103,73,0.06)' : '';
                alertEl.style.color = data.success ? 'var(--success)' : '';
            })
            .catch(function() {
                $('forgot-alert-msg').textContent = 'Connection error. Please try again.';
                alertEl.className = 'alert alert-error';
                alertEl.style.display = 'flex';
            })
            .finally(function() {
                btn.disabled = false;
                btn.textContent = 'Send Reset Link';
            });
        });

        $('reset-submit-btn').addEventListener('click', function() {
            var pw = $('reset-password').value;
            var pw2 = $('reset-password-confirm').value;
            var alertEl = $('reset-alert');

            if (pw.length < 6) {
                $('reset-alert-msg').textContent = 'Password must be at least 6 characters.';
                alertEl.className = 'alert alert-error';
                alertEl.style.display = 'flex';
                return;
            }
            if (pw !== pw2) {
                $('reset-alert-msg').textContent = 'Passwords do not match.';
                alertEl.className = 'alert alert-error';
                alertEl.style.display = 'flex';
                return;
            }

            var token = window.location.hash.replace('#reset=', '');
            var btn = this;
            btn.disabled = true;
            btn.textContent = 'Updating...';
            alertEl.style.display = 'none';

            fetch('/api/artist/reset-password', {
                method: 'POST',
                credentials: 'same-origin',
                headers: csrfHeaders('application/json'),
                body: JSON.stringify({ token: token, password: pw })
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                $('reset-alert-msg').textContent = data.message;
                alertEl.className = 'alert ' + (data.success ? 'alert-success' : 'alert-error');
                alertEl.style.display = 'flex';
                alertEl.style.background = data.success ? 'rgba(39,103,73,0.06)' : '';
                alertEl.style.color = data.success ? 'var(--success)' : '';
                if (data.success) {
                    $('reset-password').value = '';
                    $('reset-password-confirm').value = '';
                    setTimeout(function() {
                        signinForm.style.display = 'block';
                        resetWrap.style.display = 'none';
                        window.location.hash = '';
                    }, 2000);
                }
            })
            .catch(function() {
                $('reset-alert-msg').textContent = 'Connection error. Please try again.';
                alertEl.className = 'alert alert-error';
                alertEl.style.display = 'flex';
            })
            .finally(function() {
                btn.disabled = false;
                btn.textContent = 'Update Password';
            });
        });

        // Handle hash — #login, #forgot, or #reset=TOKEN
        var hash = window.location.hash;
        if (hash === '#login') {
            switchTab('signin');
        } else if (hash === '#forgot') {
            switchTab('signin');
            signinForm.style.display = 'none';
            forgotWrap.style.display = 'block';
            resetWrap.style.display = 'none';
        } else if (hash.indexOf('#reset=') === 0) {
            switchTab('signin');
            signinForm.style.display = 'none';
            forgotWrap.style.display = 'none';
            resetWrap.style.display = 'block';
        }
    })();
    </script>

    <script>
    (function() {
        'use strict';
        var authArea = document.getElementById('auth-area');
        var authDropdown = document.getElementById('auth-dropdown');
        var authLoginToggle = document.getElementById('auth-login-toggle');
        var authSignoutBtn = document.getElementById('auth-signout-btn');
        var authUserName = document.getElementById('auth-user-name');
        var authLoginForm = document.getElementById('auth-login-form');
        var authError = document.getElementById('auth-error');
        var authSubmitBtn = document.getElementById('auth-submit-btn');

        // Reuse CSRF token from the main page script to avoid double-fetch invalidation
        function getAuthCsrf() { return window._pageCsrfToken || null; }

        function showAuthError(msg) {
            authError.textContent = msg;
            authError.classList.add('show');
        }
        function hideAuthError() { authError.classList.remove('show'); }

        fetch('/api/artist/me', { credentials: 'same-origin' })
            .then(function(r) { return r.json(); })
            .then(function(d) {
                if (d.success && d.artist) {
                    authUserName.textContent = d.artist.name;
                    authArea.setAttribute('data-state', 'signed-in');
                } else {
                    authArea.setAttribute('data-state', 'signed-out');
                }
            })
            .catch(function() { authArea.setAttribute('data-state', 'signed-out'); });

        authLoginToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            authDropdown.classList.toggle('open');
            hideAuthError();
        });

        document.addEventListener('click', function(e) {
            if (!authDropdown.contains(e.target) && e.target !== authLoginToggle) {
                authDropdown.classList.remove('open');
            }
        });

        // Forgot password link in header dropdown — switch to forgot form directly
        var authForgotLink = document.getElementById('auth-forgot-link');
        if (authForgotLink) {
            authForgotLink.addEventListener('click', function(e) {
                e.preventDefault();
                authDropdown.classList.remove('open');
                // Use exposed page functions to switch to forgot password view
                var signinForm = document.getElementById('signin-form');
                var forgotWrap = document.getElementById('forgot-form-wrap');
                var resetWrap = document.getElementById('reset-form-wrap');
                // Switch to signin tab first
                var tabBtns = document.querySelectorAll('.tab-btn');
                var tabPanels = document.querySelectorAll('.tab-panel');
                tabBtns.forEach(function(t) { t.classList.toggle('active', t.dataset.tab === 'signin'); });
                tabPanels.forEach(function(p) { p.classList.toggle('active', p.id === 'panel-signin'); });
                // Show forgot form
                if (signinForm) signinForm.style.display = 'none';
                if (forgotWrap) forgotWrap.style.display = 'block';
                if (resetWrap) resetWrap.style.display = 'none';
            });
        }

        authLoginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            hideAuthError();
            var email = document.getElementById('auth-email').value.trim();
            var password = document.getElementById('auth-password').value;
            if (!email || !password) return;

            authSubmitBtn.disabled = true;
            authSubmitBtn.textContent = 'Signing in...';

            var headers = { 'Content-Type': 'application/json' };
            var ac = getAuthCsrf(); if (ac) headers['X-CSRF-Token'] = ac;

            fetch('/api/artist/login', {
                method: 'POST',
                credentials: 'same-origin',
                headers: headers,
                body: JSON.stringify({ email: email, password: password })
            })
            .then(function(r) { return r.json(); })
            .then(function(d) {
                if (d.success && d.artist) {
                    authDropdown.classList.remove('open');
                    authLoginForm.reset();
                    // Sync with page auth
                    if (typeof window._pageSetLoggedIn === 'function') {
                        window._pageSetLoggedIn(d.artist);
                    } else {
                        authUserName.textContent = d.artist.name;
                        authArea.setAttribute('data-state', 'signed-in');
                    }
                } else {
                    showAuthError(d.message || 'Invalid email or password.');
                }
            })
            .catch(function() { showAuthError('Connection error. Please try again.'); })
            .finally(function() {
                authSubmitBtn.disabled = false;
                authSubmitBtn.textContent = 'Sign In';
            });
        });

        authSignoutBtn.addEventListener('click', function() {
            // Sync with page auth (signOut handles the logout fetch)
            if (typeof window._pageSignOut === 'function') {
                window._pageSignOut();
            } else {
                var headers = {};
                var ac = getAuthCsrf(); if (ac) headers['X-CSRF-Token'] = ac;
                fetch('/api/artist/logout', {
                    method: 'POST',
                    credentials: 'same-origin',
                    headers: headers
                }).catch(function() {});
                authArea.setAttribute('data-state', 'signed-out');
                authUserName.textContent = '';
            }
        });
    })();
    </script>
</body>
</html>
